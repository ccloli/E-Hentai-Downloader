// ==UserScript==
// @name         E-Hentai Downloader
// @version      1.31.1
// @description  Download E-Hentai archive as zip file
// @author       864907600cc
// @icon         https://secure.gravatar.com/avatar/147834caf9ccb0a66b2505c753747867
// @include      http://exhentai.org/g/*
// @include      http://e-hentai.org/g/*
// @include      http://g.e-hentai.org/g/*
// @include      http://r.e-hentai.org/g/*
// @include      https://exhentai.org/g/*
// @include      https://e-hentai.org/g/*
// @include      https://g.e-hentai.org/g/*
// @include      https://r.e-hentai.org/g/*
// @namespace    http://ext.ccloli.com
// @updateURL    https://github.com/ccloli/E-Hentai-Downloader/raw/master/e-hentai-downloader.meta.js
// @downloadURL  https://github.com/ccloli/E-Hentai-Downloader/raw/master/e-hentai-downloader.user.js
// @supportURL   https://github.com/ccloli/E-Hentai-Downloader/issues
// @connect      *
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_xmlhttpRequest
// @grant        GM_info
// @grant        GM.getValue
// @grant        GM.setValue
// @grant        GM.xmlHttpRequest
// @grant        GM.info
// ==/UserScript==
"use strict";if(console.log("[EHD] E-Hentai Downloader is running."),console.log("[EHD] Bugs Report >","https://github.com/ccloli/E-Hentai-Downloader/issues | https://greasyfork.org/scripts/10379-e-hentai-downloader/feedback"),console.log('[EHD] To report a bug, it\'s recommended to provide the logs started with "[EHD]", thanks. =w='),"undefined"==typeof GM_getValue&&"undefined"!=typeof GM){var loadSetting=GM.getValue.bind(this,"ehD-setting");self.GM_setValue=GM.setValue,self.GM_xmlhttpRequest=GM.xmlHttpRequest,self.GM_info=GM.info}else loadSetting=function(e,t){return new Promise(function(e,t){try{e(GM_getValue("ehD-setting"))}catch(e){t(e)}})};0<=navigator.userAgent.indexOf("Presto")?(alert("Your Opera doesn't support E-Hentai Downloader. You need to upgrade it to Opera 15+."),console.error("[EHD] Opera 12- (Presto) doesn't support E-Hentai Downloader. UserAgent > "+navigator.userAgent)):0<=navigator.userAgent.indexOf("Trident")?(alert("Your browser doesn't support E-Hentai Downloader. You need to switch to other browsers."),console.error("[EHD] IE doesn't support E-Hentai Downloader. UserAgent > "+navigator.userAgent)):(!GM_info.scriptHandler||0<=GM_info.scriptHandler.indexOf("GreaseMonkey"))&&null!=GM_info.version&&(GM_info.version.split(".")[0]-0<3||GM_info.version.split(".")[0]-0==3&&GM_info.version.split(".")[1].split("beta")[0]-0<=2&&0<=GM_info.version.indexOf("beta")&&GM_info.version.split("beta")[1]-0<2)&&(alert("Your GreaseMonkey doesn't support E-Hentai Downloader. The first supported version is GreaseMonkey 3.2 beta 2. Please update your GreaseMonkey to enjoy. =w="),console.error("[EHD] GreaseMonkey doesn't support E-Hentai Downloader. GreaseMonkey Version > "+GM_info.version)),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=e()}}(function(){return function a(o,s,l){function d(n,e){if(!s[n]){if(!o[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(u)return u(n,!0);var i=new Error("Cannot find module '"+n+"'");throw i.code="MODULE_NOT_FOUND",i}var r=s[n]={exports:{}};o[n][0].call(r.exports,function(e){var t=o[n][1][e];return d(t||e)},r,r.exports,a,o,s,l)}return s[n].exports}for(var u="function"==typeof require&&require,e=0;e<l.length;e++)d(l[e]);return d}({1:[function(e,t,n){var f=e("./utils"),c=e("./support"),p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e){for(var t,n,i,r,a,o,s,l=[],d=0,u=e.length,c=u,h="string"!==f.getTypeOf(e);d<e.length;)c=u-d,i=h?(t=e[d++],n=d<u?e[d++]:0,d<u?e[d++]:0):(t=e.charCodeAt(d++),n=d<u?e.charCodeAt(d++):0,d<u?e.charCodeAt(d++):0),r=t>>2,a=(3&t)<<4|n>>4,o=1<c?(15&n)<<2|i>>6:64,s=2<c?63&i:64,l.push(p.charAt(r)+p.charAt(a)+p.charAt(o)+p.charAt(s));return l.join("")},n.decode=function(e){var t,n,i,r,a,o,s=0,l=0;if("data:"===e.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var d,u=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===p.charAt(64)&&u--,e.charAt(e.length-2)===p.charAt(64)&&u--,u%1!=0)throw new Error("Invalid base64 input, bad content length.");for(d=c.uint8array?new Uint8Array(0|u):new Array(0|u);s<e.length;)t=p.indexOf(e.charAt(s++))<<2|(r=p.indexOf(e.charAt(s++)))>>4,n=(15&r)<<4|(a=p.indexOf(e.charAt(s++)))>>2,i=(3&a)<<6|(o=p.indexOf(e.charAt(s++))),d[l++]=t,64!==a&&(d[l++]=n),64!==o&&(d[l++]=i);return d}},{"./support":30,"./utils":32}],2:[function(e,t,n){var i=e("./external"),r=e("./stream/DataWorker"),a=e("./stream/DataLengthProbe"),o=e("./stream/Crc32Probe");a=e("./stream/DataLengthProbe");function s(e,t,n,i,r){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=i,this.compressedContent=r}s.prototype={getContentWorker:function(){var e=new r(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new r(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},s.createWorkerFrom=function(e,t,n){return e.pipe(new o).pipe(new a("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new a("compressedSize")).withStreamInfo("compression",t)},t.exports=s},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,n){var i=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(e){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,n){var i=e("./utils");var s=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==i.getTypeOf(e)?function(e,t,n,i){var r=s,a=i+n;e^=-1;for(var o=i;o<a;o++)e=e>>>8^r[255&(e^t[o])];return-1^e}(0|t,e,e.length,0):function(e,t,n,i){var r=s,a=i+n;e^=-1;for(var o=i;o<a;o++)e=e>>>8^r[255&(e^t.charCodeAt(o))];return-1^e}(0|t,e,e.length,0):0}},{"./utils":32}],5:[function(e,t,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,t,n){var i=null;i="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:i}},{lie:58}],7:[function(e,t,n){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,r=e("pako"),a=e("./utils"),o=e("./stream/GenericWorker"),s=i?"uint8array":"array";function l(e,t){o.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}n.magic="\b\0",a.inherits(l,o),l.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(a.transformTo(s,e.data),!1)},l.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},n.compressWorker=function(e){return new l("Deflate",e)},n.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:59}],8:[function(e,t,n){var F=e("../utils"),r=e("../stream/GenericWorker"),z=e("../utf8"),L=e("../crc32"),V=e("../signature"),I=function(e,t){var n,i="";for(n=0;n<t;n++)i+=String.fromCharCode(255&e),e>>>=8;return i},a=function(e,t,n,i,r,a){var o,s,l=e.file,d=e.compression,u=a!==z.utf8encode,c=F.transformTo("string",a(l.name)),h=F.transformTo("string",z.utf8encode(l.name)),f=l.comment,p=F.transformTo("string",a(f)),g=F.transformTo("string",z.utf8encode(f)),m=h.length!==l.name.length,w=g.length!==f.length,v="",b="",y="",_=l.dir,D=l.date,x={crc32:0,compressedSize:0,uncompressedSize:0};t&&!n||(x.crc32=e.crc32,x.compressedSize=e.compressedSize,x.uncompressedSize=e.uncompressedSize);var k=0;t&&(k|=8),u||!m&&!w||(k|=2048);var A,S,E,C=0,T=0;_&&(C|=16),"UNIX"===r?(T=798,C|=(A=l.unixPermissions,S=_,(E=A)||(E=S?16893:33204),(65535&E)<<16)):(T=20,C|=63&(l.dosPermissions||0)),o=D.getUTCHours(),o<<=6,o|=D.getUTCMinutes(),o<<=5,o|=D.getUTCSeconds()/2,s=D.getUTCFullYear()-1980,s<<=4,s|=D.getUTCMonth()+1,s<<=5,s|=D.getUTCDate(),m&&(b=I(1,1)+I(L(c),4)+h,v+="up"+I(b.length,2)+b),w&&(y=I(1,1)+I(L(p),4)+g,v+="uc"+I(y.length,2)+y);var R="";return R+="\n\0",R+=I(k,2),R+=d.magic,R+=I(o,2),R+=I(s,2),R+=I(x.crc32,4),R+=I(x.compressedSize,4),R+=I(x.uncompressedSize,4),R+=I(c.length,2),R+=I(v.length,2),{fileRecord:V.LOCAL_FILE_HEADER+R+c+v,dirRecord:V.CENTRAL_FILE_HEADER+I(T,2)+R+I(p.length,2)+"\0\0\0\0"+I(C,4)+I(i,4)+c+v+p}};function i(e,t,n,i){r.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=i,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}F.inherits(i,r),i.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,r.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-i-1))/n:100}}))},i.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var n=a(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},i.prototype.closedSource=function(e){this.accumulate=!1;var t,n=this.streamFiles&&!e.file.dir,i=a(e,n,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),n)this.push({data:(t=e,V.DATA_DESCRIPTOR+I(t.crc32,4)+I(t.compressedSize,4)+I(t.uncompressedSize,4)),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},i.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n,i,r,a,o,s,l=this.bytesWritten-e,d=(n=this.dirRecords.length,i=l,r=e,a=this.zipComment,o=this.encodeFileName,s=F.transformTo("string",o(a)),V.CENTRAL_DIRECTORY_END+"\0\0\0\0"+I(n,2)+I(n,2)+I(i,4)+I(r,4)+I(s.length,2)+s);this.push({data:d,meta:{percent:100}})},i.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},i.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},i.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},i.prototype.error=function(e){var t=this._sources;if(!r.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(e){}return!0},i.prototype.lock=function(){r.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=i},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,n){var d=e("../compressions"),i=e("./ZipFileWorker");n.generateWorker=function(e,o,t){var s=new i(o.streamFiles,t,o.platform,o.encodeFileName),l=0;try{e.forEach(function(e,t){l++;var n=function(e,t){var n=e||t,i=d[n];if(!i)throw new Error(n+" is not a valid compression method !");return i}(t.options.compression,o.compression),i=t.options.compressionOptions||o.compressionOptions||{},r=t.dir,a=t.date;t._compressWorker(n,i).withStreamInfo("file",{name:e,dir:r,date:a,comment:t.comment||"",unixPermissions:t.unixPermissions,dosPermissions:t.dosPermissions}).pipe(s)}),s.entriesCount=l}catch(e){s.error(e)}return s}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,n){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new i;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}(i.prototype=e("./object")).loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.1.5",i.loadAsync=function(e,t){return(new i).loadAsync(e,t)},i.external=e("./external"),t.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,n){var i=e("./utils"),r=e("./external"),s=e("./utf8"),l=(i=e("./utils"),e("./zipEntries")),a=e("./stream/Crc32Probe"),d=e("./nodejsUtils");function u(i){return new r.Promise(function(e,t){var n=i.decompressed.getContentWorker().pipe(new a);n.on("error",function(e){t(e)}).on("end",function(){n.streamInfo.crc32!==i.decompressed.crc32?t(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}t.exports=function(e,a){var o=this;return a=i.extend(a||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),d.isNode&&d.isStream(e)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",e,!0,a.optimizedBinaryString,a.base64).then(function(e){var t=new l(a);return t.load(e),t}).then(function(e){var t=[r.Promise.resolve(e)],n=e.files;if(a.checkCRC32)for(var i=0;i<n.length;i++)t.push(u(n[i]));return r.Promise.all(t)}).then(function(e){for(var t=e.shift(),n=t.files,i=0;i<n.length;i++){var r=n[i];o.file(r.fileNameStr,r.decompressed,{binary:!0,optimizedBinaryString:!0,date:r.date,dir:r.dir,comment:r.fileCommentStr.length?r.fileCommentStr:null,unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions,createFolders:a.createFolders})}return t.zipComment.length&&(o.comment=t.zipComment),o})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,n){var i=e("../utils"),r=e("../stream/GenericWorker");function a(e,t){r.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}i.inherits(a,r),a.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",function(e){t.push({data:e,meta:{percent:0}})}).on("error",function(e){t.isPaused?this.generatedError=e:t.error(e)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})},a.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,n){var r=e("readable-stream").Readable;function i(e,t,n){r.call(this,t),this._helper=e;var i=this;e.on("data",function(e,t){i.push(e)||i._helper.pause(),n&&n(t)}).on("error",function(e){i.emit("error",e)}).on("end",function(){i.push(null)})}e("../utils").inherits(i,r),i.prototype._read=function(){this._helper.resume()},t.exports=i},{"../utils":32,"readable-stream":16}],14:[function(e,t,n){t.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){return new Buffer(e,t)},allocBuffer:function(e){return Buffer.alloc?Buffer.alloc(e):new Buffer(e)},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,n){var r=e("./utf8"),d=e("./utils"),u=e("./stream/GenericWorker"),a=e("./stream/StreamHelper"),c=e("./defaults"),h=e("./compressedObject"),f=e("./zipObject"),o=e("./generate"),p=e("./nodejsUtils"),g=e("./nodejs/NodejsStreamInputAdapter"),s=function(e,t,n){var i,r=d.getTypeOf(t),a=d.extend(n||{},c);a.date=a.date||new Date,null!==a.compression&&(a.compression=a.compression.toUpperCase()),"string"==typeof a.unixPermissions&&(a.unixPermissions=parseInt(a.unixPermissions,8)),a.unixPermissions&&16384&a.unixPermissions&&(a.dir=!0),a.dosPermissions&&16&a.dosPermissions&&(a.dir=!0),a.dir&&(e=w(e)),a.createFolders&&(i=m(e))&&v.call(this,i,!0);var o="string"===r&&!1===a.binary&&!1===a.base64;n&&void 0!==n.binary||(a.binary=!o),(t instanceof h&&0===t.uncompressedSize||a.dir||!t||0===t.length)&&(a.base64=!1,a.binary=!0,t="",a.compression="STORE",r="string");var s=null;s=t instanceof h||t instanceof u?t:p.isNode&&p.isStream(t)?new g(e,t):d.prepareContent(e,t,a.binary,a.optimizedBinaryString,a.base64);var l=new f(e,s,a);this.files[e]=l},m=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return 0<t?e.substring(0,t):""},w=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},v=function(e,t){return t=void 0!==t?t:c.createFolders,e=w(e),this.files[e]||s.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]};function l(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var i={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,i;for(t in this.files)this.files.hasOwnProperty(t)&&(i=this.files[t],(n=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(n,i))},filter:function(n){var i=[];return this.forEach(function(e,t){n(e,t)&&i.push(t)}),i},file:function(e,t,n){if(1!==arguments.length)return e=this.root+e,s.call(this,e,t,n),this;if(l(e)){var i=e;return this.filter(function(e,t){return!t.dir&&i.test(e)})}var r=this.files[this.root+e];return r&&!r.dir?r:null},folder:function(n){if(!n)return this;if(l(n))return this.filter(function(e,t){return t.dir&&n.test(e)});var e=this.root+n,t=v.call(this,e),i=this.clone();return i.root=t.name,i},remove:function(n){n=this.root+n;var e=this.files[n];if(e||("/"!==n.slice(-1)&&(n+="/"),e=this.files[n]),e&&!e.dir)delete this.files[n];else for(var t=this.filter(function(e,t){return t.name.slice(0,n.length)===n}),i=0;i<t.length;i++)delete this.files[t[i].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,n={};try{if((n=d.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");d.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var i=n.comment||this.comment||"";t=o.generateWorker(this,n,i)}catch(e){(t=new u("error")).error(e)}return new a(t,n.type||"string",n.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=i},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,n){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,n){var i=e("./DataReader");function r(e){i.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(r,i),r.prototype.byteAt=function(e){return this.data[this.zero+e]},r.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),r=e.charCodeAt(3),a=this.length-4;0<=a;--a)if(this.data[a]===t&&this.data[a+1]===n&&this.data[a+2]===i&&this.data[a+3]===r)return a-this.zero;return-1},r.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),r=e.charCodeAt(3),a=this.readData(4);return t===a[0]&&n===a[1]&&i===a[2]&&r===a[3]},r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./DataReader":18}],18:[function(e,t,n){var i=e("../utils");function r(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return i.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=r},{"../utils":32}],19:[function(e,t,n){var i=e("./Uint8ArrayReader");function r(e){i.call(this,e)}e("../utils").inherits(r,i),r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,n){var i=e("./DataReader");function r(e){i.call(this,e)}e("../utils").inherits(r,i),r.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},r.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},r.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./DataReader":18}],21:[function(e,t,n){var i=e("./ArrayReader");function r(e){i.call(this,e)}e("../utils").inherits(r,i),r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,n){var i=e("../utils"),r=e("../support"),a=e("./ArrayReader"),o=e("./StringReader"),s=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=i.getTypeOf(e);return i.checkSupport(t),"string"!==t||r.uint8array?"nodebuffer"===t?new s(e):r.uint8array?new l(i.transformTo("uint8array",e)):new a(i.transformTo("array",e)):new o(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,n){var i=e("./GenericWorker"),r=e("../utils");function a(e){i.call(this,"ConvertWorker to "+e),this.destType=e}r.inherits(a,i),a.prototype.processChunk=function(e){this.push({data:r.transformTo(this.destType,e.data),meta:e.meta})},t.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,n){var i=e("./GenericWorker"),r=e("../crc32");function a(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(a,i),a.prototype.processChunk=function(e){this.streamInfo.crc32=r(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,n){var i=e("../utils"),r=e("./GenericWorker");function a(e){r.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}i.inherits(a,r),a.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}r.prototype.processChunk.call(this,e)},t.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,n){var i=e("../utils"),r=e("./GenericWorker");function a(e){r.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=i.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}i.inherits(a,r),a.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,n){function i(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var e=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=i},{}],29:[function(e,t,n){var l=e("../utils"),r=e("./ConvertWorker"),a=e("./GenericWorker"),d=e("../base64"),i=e("../support"),o=e("../external"),s=null;if(i.nodestream)try{s=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function u(e,s){return new o.Promise(function(t,n){var i=[],r=e._internalType,a=e._outputType,o=e._mimeType;e.on("data",function(e,t){i.push(e),s&&s(t)}).on("error",function(e){i=[],n(e)}).on("end",function(){try{var e=function(e,t,n){switch(e){case"blob":return l.newBlob(l.transformTo("arraybuffer",t),n);case"base64":return d.encode(t);default:return l.transformTo(e,t)}}(a,function(e,t){var n,i=0,r=null,a=0;for(n=0;n<t.length;n++)a+=t[n].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(r=new Uint8Array(a),n=0;n<t.length;n++)r.set(t[n],i),i+=t[n].length;return r;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(r,i),o);t(e)}catch(e){n(e)}i=[]}).resume()})}function c(e,t,n){var i=t;switch(t){case"blob":case"arraybuffer":i="uint8array";break;case"base64":i="string"}try{this._internalType=i,this._outputType=t,this._mimeType=n,l.checkSupport(i),this._worker=e.pipe(new r(i)),e.lock()}catch(e){this._worker=new a("error"),this._worker.error(e)}}c.prototype={accumulate:function(e){return u(this,e)},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,function(e){t.call(n,e.data,e.meta)}):this._worker.on(e,function(){l.delay(t,arguments,n)}),this},resume:function(){return l.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(l.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new s(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer="undefined"!=typeof Buffer,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var i=new ArrayBuffer(0);try{n.blob=0===new Blob([i],{type:"application/zip"}).size}catch(e){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(i),n.blob=0===r.getBlob("application/zip").size}catch(e){n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch(e){n.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,a){for(var s=e("./utils"),l=e("./support"),n=e("./nodejsUtils"),i=e("./stream/GenericWorker"),d=new Array(256),r=0;r<256;r++)d[r]=252<=r?6:248<=r?5:240<=r?4:224<=r?3:192<=r?2:1;d[254]=d[254]=1;function o(){i.call(this,"utf-8 decode"),this.leftOver=null}function u(){i.call(this,"utf-8 encode")}a.utf8encode=function(e){return l.nodebuffer?n.newBufferFrom(e,"utf-8"):function(e){var t,n,i,r,a,o=e.length,s=0;for(r=0;r<o;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<o&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=l.uint8array?new Uint8Array(s):new Array(s),r=a=0;a<s;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<o&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),t[a++]=n<128?n:(t[a++]=n<2048?192|n>>>6:(t[a++]=n<65536?224|n>>>12:(t[a++]=240|n>>>18,128|n>>>12&63),128|n>>>6&63),128|63&n);return t}(e)},a.utf8decode=function(e){return l.nodebuffer?s.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,n,i,r,a=e.length,o=new Array(2*a);for(t=n=0;t<a;)if((i=e[t++])<128)o[n++]=i;else if(4<(r=d[i]))o[n++]=65533,t+=r-1;else{for(i&=2===r?31:3===r?15:7;1<r&&t<a;)i=i<<6|63&e[t++],r--;o[n++]=1<r?65533:i<65536?i:(i-=65536,o[n++]=55296|i>>10&1023,56320|1023&i)}return o.length!==n&&(o.subarray?o=o.subarray(0,n):o.length=n),s.applyFromCharCode(o)}(e=s.transformTo(l.uint8array?"uint8array":"array",e))},s.inherits(o,i),o.prototype.processChunk=function(e){var t=s.transformTo(l.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var n=t;(t=new Uint8Array(n.length+this.leftOver.length)).set(this.leftOver,0),t.set(n,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var i=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;0<=n&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+d[e[n]]>t?n:t}(t),r=t;i!==t.length&&(l.uint8array?(r=t.subarray(0,i),this.leftOver=t.subarray(i,t.length)):(r=t.slice(0,i),this.leftOver=t.slice(i,t.length))),this.push({data:a.utf8decode(r),meta:e.meta})},o.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=o,s.inherits(u,i),u.prototype.processChunk=function(e){this.push({data:a.utf8encode(e.data),meta:e.meta})},a.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,s){var l=e("./support"),d=e("./base64"),n=e("./nodejsUtils"),i=e("core-js/library/fn/set-immediate"),u=e("./external");function r(e){return e}function c(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}s.newBlob=function(t,n){s.checkSupport("blob");try{return new Blob([t],{type:n})}catch(e){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return i.append(t),i.getBlob(n)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var a={stringifyByChunk:function(e,t,n){var i=[],r=0,a=e.length;if(a<=n)return String.fromCharCode.apply(null,e);for(;r<a;)"array"===t||"nodebuffer"===t?i.push(String.fromCharCode.apply(null,e.slice(r,Math.min(r+n,a)))):i.push(String.fromCharCode.apply(null,e.subarray(r,Math.min(r+n,a)))),r+=n;return i.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return l.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return l.nodebuffer&&1===String.fromCharCode.apply(null,n.allocBuffer(1)).length}catch(e){return!1}}()}};function o(e){var t=65536,n=s.getTypeOf(e),i=!0;if("uint8array"===n?i=a.applyCanBeUsed.uint8array:"nodebuffer"===n&&(i=a.applyCanBeUsed.nodebuffer),i)for(;1<t;)try{return a.stringifyByChunk(e,n,t)}catch(e){t=Math.floor(t/2)}return a.stringifyByChar(e)}function h(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}s.applyFromCharCode=o;var f={};f.string={string:r,array:function(e){return c(e,new Array(e.length))},arraybuffer:function(e){return f.string.uint8array(e).buffer},uint8array:function(e){return c(e,new Uint8Array(e.length))},nodebuffer:function(e){return c(e,n.allocBuffer(e.length))}},f.array={string:o,array:r,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return n.newBufferFrom(e)}},f.arraybuffer={string:function(e){return o(new Uint8Array(e))},array:function(e){return h(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:r,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return n.newBufferFrom(new Uint8Array(e))}},f.uint8array={string:o,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:r,nodebuffer:function(e){return n.newBufferFrom(e)}},f.nodebuffer={string:o,array:function(e){return h(e,new Array(e.length))},arraybuffer:function(e){return f.nodebuffer.uint8array(e).buffer},uint8array:function(e){return h(e,new Uint8Array(e.length))},nodebuffer:r},s.transformTo=function(e,t){if(t||(t=""),!e)return t;s.checkSupport(e);var n=s.getTypeOf(t);return f[n][e](t)},s.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":l.nodebuffer&&n.isBuffer(e)?"nodebuffer":l.uint8array&&e instanceof Uint8Array?"uint8array":l.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(e){if(!l[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(e){var t,n,i="";for(n=0;n<(e||"").length;n++)i+="\\x"+((t=e.charCodeAt(n))<16?"0":"")+t.toString(16).toUpperCase();return i},s.delay=function(e,t,n){i(function(){e.apply(n||null,t||[])})},s.inherits=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n},s.extend=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===n[t]&&(n[t]=arguments[e][t]);return n},s.prepareContent=function(i,e,r,a,o){return u.Promise.resolve(e).then(function(i){return l.blob&&(i instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(i)))&&"undefined"!=typeof FileReader?new u.Promise(function(t,n){var e=new FileReader;e.onload=function(e){t(e.target.result)},e.onerror=function(e){n(e.target.error)},e.readAsArrayBuffer(i)}):i}).then(function(e){var t,n=s.getTypeOf(e);return n?("arraybuffer"===n?e=s.transformTo("uint8array",e):"string"===n&&(o?e=d.decode(e):r&&!0!==a&&(e=c(t=e,l.uint8array?new Uint8Array(t.length):new Array(t.length)))),e):u.Promise.reject(new Error("Can't read the data of '"+i+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"core-js/library/fn/set-immediate":36}],33:[function(e,t,n){var i=e("./reader/readerFor"),r=e("./utils"),a=e("./signature"),o=e("./zipEntry"),s=(e("./utf8"),e("./support"));function l(e){this.files=[],this.loadOptions=e}l.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(t)+", expected "+r.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var i=this.reader.readString(4)===t;return this.reader.setIndex(n),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=s.uint8array?"uint8array":"array",n=r.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,i=this.zip64EndOfCentralSize-44;0<i;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(e=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(e<0)throw!this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(e);var t=e;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var i=t-n;if(0<i)this.isSignature(t,a.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(e){this.reader=i(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t,n){var i=e("./reader/readerFor"),a=e("./utils"),r=e("./compressedObject"),o=e("./crc32"),s=e("./utf8"),l=e("./compressions"),d=e("./support");function u(e,t){this.options=e,this.loadOptions=t}u.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=i(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,n,i,r=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index<r;)t=e.readInt(2),n=e.readInt(2),i=e.readData(n),this.extraFields[t]={id:t,length:n,value:i}},handleUTF8:function(){var e=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=s.utf8decode(this.fileName),this.fileCommentStr=s.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var n=a.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var i=this.findExtraFieldUnicodeComment();if(null!==i)this.fileCommentStr=i;else{var r=a.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(r)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=i(e.value);return 1!==t.readInt(1)?null:o(this.fileName)!==t.readInt(4)?null:s.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=i(e.value);return 1!==t.readInt(1)?null:o(this.fileComment)!==t.readInt(4)?null:s.utf8decode(t.readData(e.length-5))}return null}},t.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,n){var a=e("./stream/StreamHelper"),i=e("./stream/DataWorker"),o=e("./utf8"),r=e("./compressedObject"),s=e("./stream/GenericWorker"),l=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};l.prototype={internalStream:function(e){var t=null,n="string";try{if(!e)throw new Error("No output type specified.");var i="string"===(n=e.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),t=this._decompressWorker();var r=!this._dataBinary;r&&!i&&(t=t.pipe(new o.Utf8EncodeWorker)),!r&&i&&(t=t.pipe(new o.Utf8DecodeWorker))}catch(e){(t=new s("error")).error(e)}return new a(t,n,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof r&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new o.Utf8EncodeWorker)),r.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof r?this._data.getContentWorker():this._data instanceof s?this._data:new i(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},c=0;c<d.length;c++)l.prototype[d[c]]=u;t.exports=l},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,n){e("../modules/web.immediate"),t.exports=e("../modules/_core").setImmediate},{"../modules/_core":40,"../modules/web.immediate":56}],37:[function(e,t,n){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],38:[function(e,t,n){var i=e("./_is-object");t.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":51}],39:[function(e,t,n){var i={}.toString;t.exports=function(e){return i.call(e).slice(8,-1)}},{}],40:[function(e,t,n){var i=t.exports={version:"2.3.0"};"number"==typeof __e&&(__e=i)},{}],41:[function(e,t,n){var a=e("./_a-function");t.exports=function(i,r,e){if(a(i),void 0===r)return i;switch(e){case 1:return function(e){return i.call(r,e)};case 2:return function(e,t){return i.call(r,e,t)};case 3:return function(e,t,n){return i.call(r,e,t,n)}}return function(){return i.apply(r,arguments)}}},{"./_a-function":37}],42:[function(e,t,n){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":45}],43:[function(e,t,n){var i=e("./_is-object"),r=e("./_global").document,a=i(r)&&i(r.createElement);t.exports=function(e){return a?r.createElement(e):{}}},{"./_global":46,"./_is-object":51}],44:[function(e,t,n){var g=e("./_global"),m=e("./_core"),w=e("./_ctx"),v=e("./_hide"),b="prototype",y=function(e,t,n){var i,r,a,o=e&y.F,s=e&y.G,l=e&y.S,d=e&y.P,u=e&y.B,c=e&y.W,h=s?m:m[t]||(m[t]={}),f=h[b],p=s?g:l?g[t]:(g[t]||{})[b];for(i in s&&(n=t),n)(r=!o&&p&&void 0!==p[i])&&i in h||(a=r?p[i]:n[i],h[i]=s&&"function"!=typeof p[i]?n[i]:u&&r?w(a,g):c&&p[i]==a?function(i){var e=function(e,t,n){if(this instanceof i){switch(arguments.length){case 0:return new i;case 1:return new i(e);case 2:return new i(e,t)}return new i(e,t,n)}return i.apply(this,arguments)};return e[b]=i[b],e}(a):d&&"function"==typeof a?w(Function.call,a):a,d&&((h.virtual||(h.virtual={}))[i]=a,e&y.R&&f&&!f[i]&&v(f,i,a)))};y.F=1,y.G=2,y.S=4,y.P=8,y.B=16,y.W=32,y.U=64,y.R=128,t.exports=y},{"./_core":40,"./_ctx":41,"./_global":46,"./_hide":47}],45:[function(e,t,n){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],46:[function(e,t,n){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},{}],47:[function(e,t,n){var i=e("./_object-dp"),r=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,n){return i.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},{"./_descriptors":42,"./_object-dp":52,"./_property-desc":53}],48:[function(e,t,n){t.exports=e("./_global").document&&document.documentElement},{"./_global":46}],49:[function(e,t,n){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":42,"./_dom-create":43,"./_fails":45}],50:[function(e,t,n){t.exports=function(e,t,n){var i=void 0===n;switch(t.length){case 0:return i?e():e.call(n);case 1:return i?e(t[0]):e.call(n,t[0]);case 2:return i?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},{}],51:[function(e,t,n){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],52:[function(e,t,n){var i=e("./_an-object"),r=e("./_ie8-dom-define"),a=e("./_to-primitive"),o=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function(e,t,n){if(i(e),t=a(t,!0),i(n),r)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},{"./_an-object":38,"./_descriptors":42,"./_ie8-dom-define":49,"./_to-primitive":55}],53:[function(e,t,n){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],54:[function(e,t,n){var i,r,a,o=e("./_ctx"),s=e("./_invoke"),l=e("./_html"),d=e("./_dom-create"),u=e("./_global"),c=u.process,h=u.setImmediate,f=u.clearImmediate,p=u.MessageChannel,g=0,m={},w="onreadystatechange",v=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},b=function(e){v.call(e.data)};h&&f||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return m[++g]=function(){s("function"==typeof e?e:Function(e),t)},i(g),g},f=function(e){delete m[e]},"process"==e("./_cof")(c)?i=function(e){c.nextTick(o(v,e,1))}:p?(a=(r=new p).port2,r.port1.onmessage=b,i=o(a.postMessage,a,1)):u.addEventListener&&"function"==typeof postMessage&&!u.importScripts?(i=function(e){u.postMessage(e+"","*")},u.addEventListener("message",b,!1)):i=w in d("script")?function(e){l.appendChild(d("script"))[w]=function(){l.removeChild(this),v.call(e)}}:function(e){setTimeout(o(v,e,1),0)}),t.exports={set:h,clear:f}},{"./_cof":39,"./_ctx":41,"./_dom-create":43,"./_global":46,"./_html":48,"./_invoke":50}],55:[function(e,t,n){var r=e("./_is-object");t.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":51}],56:[function(e,t,n){var i=e("./_export"),r=e("./_task");i(i.G+i.B,{setImmediate:r.set,clearImmediate:r.clear})},{"./_export":44,"./_task":54}],57:[function(e,u,t){(function(t){var n,i,e=t.MutationObserver||t.WebKitMutationObserver;if(e){var r=0,a=new e(d),o=t.document.createTextNode("");a.observe(o,{characterData:!0}),n=function(){o.data=r=++r%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){d(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(d,0)};else{var s=new t.MessageChannel;s.port1.onmessage=d,n=function(){s.port2.postMessage(0)}}var l=[];function d(){var e,t;i=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}i=!1}u.exports=function(e){1!==l.push(e)||i||n()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],58:[function(e,t,n){var r=e("immediate");function d(){}var u={},a=["REJECTED"],o=["FULFILLED"],i=["PENDING"];function s(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=i,this.queue=[],this.outcome=void 0,e!==d&&f(this,e)}function l(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function c(t,n,i){r(function(){var e;try{e=n(i)}catch(e){return u.reject(t,e)}e===t?u.reject(t,new TypeError("Cannot resolve promise with itself")):u.resolve(t,e)})}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(t,e){var n=!1;function i(e){n||(n=!0,u.reject(t,e))}function r(e){n||(n=!0,u.resolve(t,e))}var a=p(function(){e(r,i)});"error"===a.status&&i(a.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}(t.exports=s).prototype.catch=function(e){return this.then(null,e)},s.prototype.then=function(e,t){if("function"!=typeof e&&this.state===o||"function"!=typeof t&&this.state===a)return this;var n=new this.constructor(d);this.state!==i?c(n,this.state===o?e:t,this.outcome):this.queue.push(new l(n,e,t));return n},l.prototype.callFulfilled=function(e){u.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){c(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){u.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){c(this.promise,this.onRejected,e)},u.resolve=function(e,t){var n=p(h,t);if("error"===n.status)return u.reject(e,n.value);var i=n.value;if(i)f(e,i);else{e.state=o,e.outcome=t;for(var r=-1,a=e.queue.length;++r<a;)e.queue[r].callFulfilled(t)}return e},u.reject=function(e,t){e.state=a,e.outcome=t;for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callRejected(t);return e},s.resolve=function(e){if(e instanceof this)return e;return u.resolve(new this(d),e)},s.reject=function(e){var t=new this(d);return u.reject(t,e)},s.all=function(e){var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,r=!1;if(!i)return this.resolve([]);var a=new Array(i),o=0,t=-1,s=new this(d);for(;++t<i;)l(e[t],t);return s;function l(e,t){n.resolve(e).then(function(e){a[t]=e,++o!==i||r||(r=!0,u.resolve(s,a))},function(e){r||(r=!0,u.reject(s,e))})}},s.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);var r=-1,a=new this(d);for(;++r<n;)o=e[r],t.resolve(o).then(function(e){i||(i=!0,u.resolve(a,e))},function(e){i||(i=!0,u.reject(a,e))});var o;return a}},{immediate:57}],59:[function(e,t,n){var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=i},{"./lib/deflate":60,"./lib/inflate":61,"./lib/utils/common":62,"./lib/zlib/constants":65}],60:[function(e,t,n){var o=e("./zlib/deflate"),s=e("./utils/common"),l=e("./utils/strings"),r=e("./zlib/messages"),a=e("./zlib/zstream"),d=Object.prototype.toString,u=0,c=-1,h=0,f=8;function p(e){if(!(this instanceof p))return new p(e);this.options=s.assign({level:c,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},e||{});var t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var n=o.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==u)throw new Error(r[n]);if(t.header&&o.deflateSetHeader(this.strm,t.header),t.dictionary){var i;if(i="string"==typeof t.dictionary?l.string2buf(t.dictionary):"[object ArrayBuffer]"===d.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=o.deflateSetDictionary(this.strm,i))!==u)throw new Error(r[n]);this._dict_set=!0}}function i(e,t){var n=new p(t);if(n.push(e,!0),n.err)throw n.msg||r[n.err];return n.result}p.prototype.push=function(e,t){var n,i,r=this.strm,a=this.options.chunkSize;if(this.ended)return!1;i=t===~~t?t:!0===t?4:0,"string"==typeof e?r.input=l.string2buf(e):"[object ArrayBuffer]"===d.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new s.Buf8(a),r.next_out=0,r.avail_out=a),1!==(n=o.deflate(r,i))&&n!==u)return this.onEnd(n),!(this.ended=!0);0!==r.avail_out&&(0!==r.avail_in||4!==i&&2!==i)||("string"===this.options.to?this.onData(l.buf2binstring(s.shrinkBuf(r.output,r.next_out))):this.onData(s.shrinkBuf(r.output,r.next_out)))}while((0<r.avail_in||0===r.avail_out)&&1!==n);return 4===i?(n=o.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===u):2!==i||(this.onEnd(u),!(r.avail_out=0))},p.prototype.onData=function(e){this.chunks.push(e)},p.prototype.onEnd=function(e){e===u&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=p,n.deflate=i,n.deflateRaw=function(e,t){return(t=t||{}).raw=!0,i(e,t)},n.gzip=function(e,t){return(t=t||{}).gzip=!0,i(e,t)}},{"./utils/common":62,"./utils/strings":63,"./zlib/deflate":67,"./zlib/messages":72,"./zlib/zstream":74}],61:[function(e,t,n){var h=e("./zlib/inflate"),f=e("./utils/common"),p=e("./utils/strings"),g=e("./zlib/constants"),i=e("./zlib/messages"),r=e("./zlib/zstream"),a=e("./zlib/gzheader"),m=Object.prototype.toString;function o(e){if(!(this instanceof o))return new o(e);this.options=f.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;var n=h.inflateInit2(this.strm,t.windowBits);if(n!==g.Z_OK)throw new Error(i[n]);this.header=new a,h.inflateGetHeader(this.strm,this.header)}function s(e,t){var n=new o(t);if(n.push(e,!0),n.err)throw n.msg||i[n.err];return n.result}o.prototype.push=function(e,t){var n,i,r,a,o,s,l=this.strm,d=this.options.chunkSize,u=this.options.dictionary,c=!1;if(this.ended)return!1;i=t===~~t?t:!0===t?g.Z_FINISH:g.Z_NO_FLUSH,"string"==typeof e?l.input=p.binstring2buf(e):"[object ArrayBuffer]"===m.call(e)?l.input=new Uint8Array(e):l.input=e,l.next_in=0,l.avail_in=l.input.length;do{if(0===l.avail_out&&(l.output=new f.Buf8(d),l.next_out=0,l.avail_out=d),(n=h.inflate(l,g.Z_NO_FLUSH))===g.Z_NEED_DICT&&u&&(s="string"==typeof u?p.string2buf(u):"[object ArrayBuffer]"===m.call(u)?new Uint8Array(u):u,n=h.inflateSetDictionary(this.strm,s)),n===g.Z_BUF_ERROR&&!0===c&&(n=g.Z_OK,c=!1),n!==g.Z_STREAM_END&&n!==g.Z_OK)return this.onEnd(n),!(this.ended=!0);l.next_out&&(0!==l.avail_out&&n!==g.Z_STREAM_END&&(0!==l.avail_in||i!==g.Z_FINISH&&i!==g.Z_SYNC_FLUSH)||("string"===this.options.to?(r=p.utf8border(l.output,l.next_out),a=l.next_out-r,o=p.buf2string(l.output,r),l.next_out=a,l.avail_out=d-a,a&&f.arraySet(l.output,l.output,r,a,0),this.onData(o)):this.onData(f.shrinkBuf(l.output,l.next_out)))),0===l.avail_in&&0===l.avail_out&&(c=!0)}while((0<l.avail_in||0===l.avail_out)&&n!==g.Z_STREAM_END);return n===g.Z_STREAM_END&&(i=g.Z_FINISH),i===g.Z_FINISH?(n=h.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===g.Z_OK):i!==g.Z_SYNC_FLUSH||(this.onEnd(g.Z_OK),!(l.avail_out=0))},o.prototype.onData=function(e){this.chunks.push(e)},o.prototype.onEnd=function(e){e===g.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=o,n.inflate=s,n.inflateRaw=function(e,t){return(t=t||{}).raw=!0,s(e,t)},n.ungzip=s},{"./utils/common":62,"./utils/strings":63,"./zlib/constants":65,"./zlib/gzheader":68,"./zlib/inflate":70,"./zlib/messages":72,"./zlib/zstream":74}],62:[function(e,t,n){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var a=0;a<i;a++)e[r+a]=t[n+a]},flattenChunks:function(e){var t,n,i,r,a,o;for(t=i=0,n=e.length;t<n;t++)i+=e[t].length;for(o=new Uint8Array(i),t=r=0,n=e.length;t<n;t++)a=e[t],o.set(a,r),r+=a.length;return o}},a={arraySet:function(e,t,n,i,r){for(var a=0;a<i;a++)e[r+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(i)},{}],63:[function(e,t,n){var l=e("./common"),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var d=new l.Buf8(256),i=0;i<256;i++)d[i]=252<=i?6:248<=i?5:240<=i?4:224<=i?3:192<=i?2:1;function u(e,t){if(t<65537&&(e.subarray&&a||!e.subarray&&r))return String.fromCharCode.apply(null,l.shrinkBuf(e,t));for(var n="",i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n}d[254]=d[254]=1,n.string2buf=function(e){var t,n,i,r,a,o=e.length,s=0;for(r=0;r<o;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<o&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new l.Buf8(s),r=a=0;a<s;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<o&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),t[a++]=n<128?n:(t[a++]=n<2048?192|n>>>6:(t[a++]=n<65536?224|n>>>12:(t[a++]=240|n>>>18,128|n>>>12&63),128|n>>>6&63),128|63&n);return t},n.buf2binstring=function(e){return u(e,e.length)},n.binstring2buf=function(e){for(var t=new l.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,i,r,a,o=t||e.length,s=new Array(2*o);for(n=i=0;n<o;)if((r=e[n++])<128)s[i++]=r;else if(4<(a=d[r]))s[i++]=65533,n+=a-1;else{for(r&=2===a?31:3===a?15:7;1<a&&n<o;)r=r<<6|63&e[n++],a--;s[i++]=1<a?65533:r<65536?r:(r-=65536,s[i++]=55296|r>>10&1023,56320|1023&r)}return u(s,i)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;0<=n&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+d[e[n]]>t?n:t}},{"./common":62}],64:[function(e,t,n){t.exports=function(e,t,n,i){for(var r=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){for(n-=o=2e3<n?2e3:n;a=a+(r=r+t[i++]|0)|0,--o;);r%=65521,a%=65521}return r|a<<16|0}},{}],65:[function(e,t,n){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(e,t,n){var s=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();t.exports=function(e,t,n,i){var r=s,a=i+n;e^=-1;for(var o=i;o<a;o++)e=e>>>8^r[255&(e^t[o])];return-1^e}},{}],67:[function(e,t,n){var l,h=e("../utils/common"),d=e("./trees"),f=e("./adler32"),p=e("./crc32"),i=e("./messages"),u=0,c=4,g=0,m=-2,w=-1,v=4,r=2,b=8,y=9,a=286,o=30,s=19,_=2*a+1,D=15,x=3,k=258,A=k+x+1,S=42,E=113,C=1,T=2,R=3,F=4;function z(e,t){return e.msg=i[t],t}function L(e){return(e<<1)-(4<e?9:0)}function V(e){for(var t=e.length;0<=--t;)e[t]=0}function I(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(h.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function N(e,t){d._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,I(e.strm)}function B(e,t){e.pending_buf[e.pending++]=t}function P(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function O(e,t){var n,i,r=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-A?e.strstart-(e.w_size-A):0,d=e.window,u=e.w_mask,c=e.prev,h=e.strstart+k,f=d[a+o-1],p=d[a+o];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(d[(n=t)+o]===p&&d[n+o-1]===f&&d[n]===d[a]&&d[++n]===d[a+1]){a+=2,n++;do{}while(d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&d[++a]===d[++n]&&a<h);if(i=k-(h-a),a=h-k,o<i){if(e.match_start=t,s<=(o=i))break;f=d[a+o-1],p=d[a+o]}}}while((t=c[t&u])>l&&0!=--r);return o<=e.lookahead?o:e.lookahead}function U(e){var t,n,i,r,a,o,s,l,d,u,c=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=c+(c-A)){for(h.arraySet(e.window,e.window,c,c,0),e.match_start-=c,e.strstart-=c,e.block_start-=c,t=n=e.hash_size;i=e.head[--t],e.head[t]=c<=i?i-c:0,--n;);for(t=n=c;i=e.prev[--t],e.prev[t]=c<=i?i-c:0,--n;);r+=c}if(0===e.strm.avail_in)break;if(o=e.strm,s=e.window,l=e.strstart+e.lookahead,d=r,u=void 0,u=o.avail_in,d<u&&(u=d),n=0===u?0:(o.avail_in-=u,h.arraySet(s,o.input,o.next_in,u,l),1===o.state.wrap?o.adler=f(o.adler,s,u,l):2===o.state.wrap&&(o.adler=p(o.adler,s,u,l)),o.next_in+=u,o.total_in+=u,u),e.lookahead+=n,e.lookahead+e.insert>=x)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+x-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<x)););}while(e.lookahead<A&&0!==e.strm.avail_in)}function H(e,t){for(var n,i;;){if(e.lookahead<A){if(U(e),e.lookahead<A&&t===u)return C;if(0===e.lookahead)break}if(n=0,e.lookahead>=x&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-A&&(e.match_length=O(e,n)),e.match_length>=x)if(i=d._tr_tally(e,e.strstart-e.match_start,e.match_length-x),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=x){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=d._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(N(e,!1),0===e.strm.avail_out))return C}return e.insert=e.strstart<x-1?e.strstart:x-1,t===c?(N(e,!0),0===e.strm.avail_out?R:F):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?C:T}function M(e,t){for(var n,i,r;;){if(e.lookahead<A){if(U(e),e.lookahead<A&&t===u)return C;if(0===e.lookahead)break}if(n=0,e.lookahead>=x&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=x-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-A&&(e.match_length=O(e,n),e.match_length<=5&&(1===e.strategy||e.match_length===x&&4096<e.strstart-e.match_start)&&(e.match_length=x-1)),e.prev_length>=x&&e.match_length<=e.prev_length){for(r=e.strstart+e.lookahead-x,i=d._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-x),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+x-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=x-1,e.strstart++,i&&(N(e,!1),0===e.strm.avail_out))return C}else if(e.match_available){if((i=d._tr_tally(e,0,e.window[e.strstart-1]))&&N(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return C}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=d._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<x-1?e.strstart:x-1,t===c?(N(e,!0),0===e.strm.avail_out?R:F):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?C:T}function j(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}function G(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new h.Buf16(2*_),this.dyn_dtree=new h.Buf16(2*(2*o+1)),this.bl_tree=new h.Buf16(2*(2*s+1)),V(this.dyn_ltree),V(this.dyn_dtree),V(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new h.Buf16(D+1),this.heap=new h.Buf16(2*a+1),V(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new h.Buf16(2*a+1),V(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function W(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=r,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?S:E,e.adler=2===t.wrap?0:1,t.last_flush=u,d._tr_init(t),g):z(e,m)}function q(e){var t,n=W(e);return n===g&&((t=e.state).window_size=2*t.w_size,V(t.head),t.max_lazy_match=l[t.level].max_lazy,t.good_match=l[t.level].good_length,t.nice_match=l[t.level].nice_length,t.max_chain_length=l[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=x-1,t.match_available=0,t.ins_h=0),n}function Z(e,t,n,i,r,a){if(!e)return m;var o=1;if(t===w&&(t=6),i<0?(o=0,i=-i):15<i&&(o=2,i-=16),r<1||y<r||n!==b||i<8||15<i||t<0||9<t||a<0||v<a)return z(e,m);8===i&&(i=9);var s=new G;return(e.state=s).strm=e,s.wrap=o,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+x-1)/x),s.window=new h.Buf8(2*s.w_size),s.head=new h.Buf16(s.hash_size),s.prev=new h.Buf16(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new h.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=a,s.method=n,q(e)}l=[new j(0,0,0,0,function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(U(e),0===e.lookahead&&t===u)return C;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,N(e,!1),0===e.strm.avail_out))return C;if(e.strstart-e.block_start>=e.w_size-A&&(N(e,!1),0===e.strm.avail_out))return C}return e.insert=0,t===c?(N(e,!0),0===e.strm.avail_out?R:F):(e.strstart>e.block_start&&(N(e,!1),e.strm.avail_out),C)}),new j(4,4,8,4,H),new j(4,5,16,8,H),new j(4,6,32,32,H),new j(4,4,16,16,M),new j(8,16,32,32,M),new j(8,16,128,128,M),new j(8,32,128,256,M),new j(32,128,258,1024,M),new j(32,258,258,4096,M)],n.deflateInit=function(e,t){return Z(e,t,b,15,8,0)},n.deflateInit2=Z,n.deflateReset=q,n.deflateResetKeep=W,n.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?m:(e.state.gzhead=t,g):m},n.deflate=function(e,t){var n,i,r,a;if(!e||!e.state||5<t||t<0)return e?z(e,m):m;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||666===i.status&&t!==c)return z(e,0===e.avail_out?-5:m);if(i.strm=e,n=i.last_flush,i.last_flush=t,i.status===S)if(2===i.wrap)e.adler=0,B(i,31),B(i,139),B(i,8),i.gzhead?(B(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),B(i,255&i.gzhead.time),B(i,i.gzhead.time>>8&255),B(i,i.gzhead.time>>16&255),B(i,i.gzhead.time>>24&255),B(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),B(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(B(i,255&i.gzhead.extra.length),B(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=p(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(B(i,0),B(i,0),B(i,0),B(i,0),B(i,0),B(i,9===i.level?2:2<=i.strategy||i.level<2?4:0),B(i,3),i.status=E);else{var o=b+(i.w_bits-8<<4)<<8;o|=(2<=i.strategy||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(o|=32),o+=31-o%31,i.status=E,P(i,o),0!==i.strstart&&(P(i,e.adler>>>16),P(i,65535&e.adler)),e.adler=1}if(69===i.status)if(i.gzhead.extra){for(r=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>r&&(e.adler=p(e.adler,i.pending_buf,i.pending-r,r)),I(e),r=i.pending,i.pending!==i.pending_buf_size));)B(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>r&&(e.adler=p(e.adler,i.pending_buf,i.pending-r,r)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(e.adler=p(e.adler,i.pending_buf,i.pending-r,r)),I(e),r=i.pending,i.pending===i.pending_buf_size)){a=1;break}B(i,a=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0)}while(0!==a);i.gzhead.hcrc&&i.pending>r&&(e.adler=p(e.adler,i.pending_buf,i.pending-r,r)),0===a&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){r=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>r&&(e.adler=p(e.adler,i.pending_buf,i.pending-r,r)),I(e),r=i.pending,i.pending===i.pending_buf_size)){a=1;break}B(i,a=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0)}while(0!==a);i.gzhead.hcrc&&i.pending>r&&(e.adler=p(e.adler,i.pending_buf,i.pending-r,r)),0===a&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&I(e),i.pending+2<=i.pending_buf_size&&(B(i,255&e.adler),B(i,e.adler>>8&255),e.adler=0,i.status=E)):i.status=E),0!==i.pending){if(I(e),0===e.avail_out)return i.last_flush=-1,g}else if(0===e.avail_in&&L(t)<=L(n)&&t!==c)return z(e,-5);if(666===i.status&&0!==e.avail_in)return z(e,-5);if(0!==e.avail_in||0!==i.lookahead||t!==u&&666!==i.status){var s=2===i.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(U(e),0===e.lookahead)){if(t===u)return C;break}if(e.match_length=0,n=d._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(N(e,!1),0===e.strm.avail_out))return C}return e.insert=0,t===c?(N(e,!0),0===e.strm.avail_out?R:F):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?C:T}(i,t):3===i.strategy?function(e,t){for(var n,i,r,a,o=e.window;;){if(e.lookahead<=k){if(U(e),e.lookahead<=k&&t===u)return C;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=x&&0<e.strstart&&(i=o[r=e.strstart-1])===o[++r]&&i===o[++r]&&i===o[++r]){a=e.strstart+k;do{}while(i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&r<a);e.match_length=k-(a-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=x?(n=d._tr_tally(e,1,e.match_length-x),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=d._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(N(e,!1),0===e.strm.avail_out))return C}return e.insert=0,t===c?(N(e,!0),0===e.strm.avail_out?R:F):e.last_lit&&(N(e,!1),0===e.strm.avail_out)?C:T}(i,t):l[i.level].func(i,t);if(s!==R&&s!==F||(i.status=666),s===C||s===R)return 0===e.avail_out&&(i.last_flush=-1),g;if(s===T&&(1===t?d._tr_align(i):5!==t&&(d._tr_stored_block(i,0,0,!1),3===t&&(V(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),I(e),0===e.avail_out))return i.last_flush=-1,g}return t!==c?g:i.wrap<=0?1:(2===i.wrap?(B(i,255&e.adler),B(i,e.adler>>8&255),B(i,e.adler>>16&255),B(i,e.adler>>24&255),B(i,255&e.total_in),B(i,e.total_in>>8&255),B(i,e.total_in>>16&255),B(i,e.total_in>>24&255)):(P(i,e.adler>>>16),P(i,65535&e.adler)),I(e),0<i.wrap&&(i.wrap=-i.wrap),0!==i.pending?g:1)},n.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==S&&69!==t&&73!==t&&91!==t&&103!==t&&t!==E&&666!==t?z(e,m):(e.state=null,t===E?z(e,-3):g):m},n.deflateSetDictionary=function(e,t){var n,i,r,a,o,s,l,d,u=t.length;if(!e||!e.state)return m;if(2===(a=(n=e.state).wrap)||1===a&&n.status!==S||n.lookahead)return m;for(1===a&&(e.adler=f(e.adler,t,u,0)),n.wrap=0,u>=n.w_size&&(0===a&&(V(n.head),n.strstart=0,n.block_start=0,n.insert=0),d=new h.Buf8(n.w_size),h.arraySet(d,t,u-n.w_size,n.w_size,0),t=d,u=n.w_size),o=e.avail_in,s=e.next_in,l=e.input,e.avail_in=u,e.next_in=0,e.input=t,U(n);n.lookahead>=x;){for(i=n.strstart,r=n.lookahead-(x-1);n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+x-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,--r;);n.strstart=i,n.lookahead=x-1,U(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=x-1,n.match_available=0,e.next_in=s,e.input=l,e.avail_in=o,n.wrap=a,g},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./messages":72,"./trees":73}],68:[function(e,t,n){t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],69:[function(e,t,n){t.exports=function(e,t){var n,i,r,a,o,s,l,d,u,c,h,f,p,g,m,w,v,b,y,_,D,x,k,A,S;n=e.state,i=e.next_in,A=e.input,r=i+(e.avail_in-5),a=e.next_out,S=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),l=n.dmax,d=n.wsize,u=n.whave,c=n.wnext,h=n.window,f=n.hold,p=n.bits,g=n.lencode,m=n.distcode,w=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;e:do{p<15&&(f+=A[i++]<<p,p+=8,f+=A[i++]<<p,p+=8),b=g[f&w];t:for(;;){if(f>>>=y=b>>>24,p-=y,0===(y=b>>>16&255))S[a++]=65535&b;else{if(!(16&y)){if(0==(64&y)){b=g[(65535&b)+(f&(1<<y)-1)];continue t}if(32&y){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}_=65535&b,(y&=15)&&(p<y&&(f+=A[i++]<<p,p+=8),_+=f&(1<<y)-1,f>>>=y,p-=y),p<15&&(f+=A[i++]<<p,p+=8,f+=A[i++]<<p,p+=8),b=m[f&v];n:for(;;){if(f>>>=y=b>>>24,p-=y,!(16&(y=b>>>16&255))){if(0==(64&y)){b=m[(65535&b)+(f&(1<<y)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(D=65535&b,p<(y&=15)&&(f+=A[i++]<<p,(p+=8)<y&&(f+=A[i++]<<p,p+=8)),l<(D+=f&(1<<y)-1)){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=y,p-=y,(y=a-o)<D){if(u<(y=D-y)&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(k=h,(x=0)===c){if(x+=d-y,y<_){for(_-=y;S[a++]=h[x++],--y;);x=a-D,k=S}}else if(c<y){if(x+=d+c-y,(y-=c)<_){for(_-=y;S[a++]=h[x++],--y;);if(x=0,c<_){for(_-=y=c;S[a++]=h[x++],--y;);x=a-D,k=S}}}else if(x+=c-y,y<_){for(_-=y;S[a++]=h[x++],--y;);x=a-D,k=S}for(;2<_;)S[a++]=k[x++],S[a++]=k[x++],S[a++]=k[x++],_-=3;_&&(S[a++]=k[x++],1<_&&(S[a++]=k[x++]))}else{for(x=a-D;S[a++]=S[x++],S[a++]=S[x++],S[a++]=S[x++],2<(_-=3););_&&(S[a++]=S[x++],1<_&&(S[a++]=S[x++]))}break}}break}}while(i<r&&a<s);i-=_=p>>3,f&=(1<<(p-=_<<3))-1,e.next_in=i,e.next_out=a,e.avail_in=i<r?r-i+5:5-(i-r),e.avail_out=a<s?s-a+257:257-(a-s),n.hold=f,n.bits=p}},{}],70:[function(e,t,n){var T=e("../utils/common"),R=e("./adler32"),F=e("./crc32"),z=e("./inffast"),L=e("./inftrees"),V=1,I=2,N=0,B=-2,P=1,i=852,r=592;function O(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new T.Buf16(320),this.work=new T.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function o(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=P,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new T.Buf32(i),t.distcode=t.distdyn=new T.Buf32(r),t.sane=1,t.back=-1,N):B}function s(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,o(e)):B}function l(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?B:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,s(e))):B}function d(e,t){var n,i;return e?(i=new a,(e.state=i).window=null,(n=l(e,t))!==N&&(e.state=null),n):B}var u,c,h=!0;function U(e){if(h){var t;for(u=new T.Buf32(512),c=new T.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(L(V,e.lens,0,288,u,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;L(I,e.lens,0,32,c,0,e.work,{bits:5}),h=!1}e.lencode=u,e.lenbits=9,e.distcode=c,e.distbits=5}function H(e,t,n,i){var r,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new T.Buf8(a.wsize)),i>=a.wsize?(T.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(i<(r=a.wsize-a.wnext)&&(r=i),T.arraySet(a.window,t,n-i,r,a.wnext),(i-=r)?(T.arraySet(a.window,t,n-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0}n.inflateReset=s,n.inflateReset2=l,n.inflateResetKeep=o,n.inflateInit=function(e){return d(e,15)},n.inflateInit2=d,n.inflate=function(e,t){var n,i,r,a,o,s,l,d,u,c,h,f,p,g,m,w,v,b,y,_,D,x,k,A,S=0,E=new T.Buf8(4),C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return B;12===(n=e.state).mode&&(n.mode=13),o=e.next_out,r=e.output,l=e.avail_out,a=e.next_in,i=e.input,s=e.avail_in,d=n.hold,u=n.bits,c=s,h=l,x=N;e:for(;;)switch(n.mode){case P:if(0===n.wrap){n.mode=13;break}for(;u<16;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}if(2&n.wrap&&35615===d){E[n.check=0]=255&d,E[1]=d>>>8&255,n.check=F(n.check,E,2,0),u=d=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&d)){e.msg="unknown compression method",n.mode=30;break}if(u-=4,D=8+(15&(d>>>=4)),0===n.wbits)n.wbits=D;else if(D>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<D,e.adler=n.check=1,n.mode=512&d?10:12,u=d=0;break;case 2:for(;u<16;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}if(n.flags=d,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=d>>8&1),512&n.flags&&(E[0]=255&d,E[1]=d>>>8&255,n.check=F(n.check,E,2,0)),u=d=0,n.mode=3;case 3:for(;u<32;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}n.head&&(n.head.time=d),512&n.flags&&(E[0]=255&d,E[1]=d>>>8&255,E[2]=d>>>16&255,E[3]=d>>>24&255,n.check=F(n.check,E,4,0)),u=d=0,n.mode=4;case 4:for(;u<16;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}n.head&&(n.head.xflags=255&d,n.head.os=d>>8),512&n.flags&&(E[0]=255&d,E[1]=d>>>8&255,n.check=F(n.check,E,2,0)),u=d=0,n.mode=5;case 5:if(1024&n.flags){for(;u<16;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}n.length=d,n.head&&(n.head.extra_len=d),512&n.flags&&(E[0]=255&d,E[1]=d>>>8&255,n.check=F(n.check,E,2,0)),u=d=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&(s<(f=n.length)&&(f=s),f&&(n.head&&(D=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),T.arraySet(n.head.extra,i,a,f,D)),512&n.flags&&(n.check=F(n.check,i,f,a)),s-=f,a+=f,n.length-=f),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===s)break e;for(f=0;D=i[a+f++],n.head&&D&&n.length<65536&&(n.head.name+=String.fromCharCode(D)),D&&f<s;);if(512&n.flags&&(n.check=F(n.check,i,f,a)),s-=f,a+=f,D)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===s)break e;for(f=0;D=i[a+f++],n.head&&D&&n.length<65536&&(n.head.comment+=String.fromCharCode(D)),D&&f<s;);if(512&n.flags&&(n.check=F(n.check,i,f,a)),s-=f,a+=f,D)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;u<16;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}if(d!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}u=d=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;u<32;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}e.adler=n.check=O(d),u=d=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=s,n.hold=d,n.bits=u,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){d>>>=7&u,u-=7&u,n.mode=27;break}for(;u<3;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}switch(n.last=1&d,u-=1,3&(d>>>=1)){case 0:n.mode=14;break;case 1:if(U(n),n.mode=20,6!==t)break;d>>>=2,u-=2;break e;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}d>>>=2,u-=2;break;case 14:for(d>>>=7&u,u-=7&u;u<32;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&d,u=d=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(f=n.length){if(s<f&&(f=s),l<f&&(f=l),0===f)break e;T.arraySet(r,i,a,f,o),s-=f,a+=f,l-=f,o+=f,n.length-=f;break}n.mode=12;break;case 17:for(;u<14;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}if(n.nlen=257+(31&d),d>>>=5,u-=5,n.ndist=1+(31&d),d>>>=5,u-=5,n.ncode=4+(15&d),d>>>=4,u-=4,286<n.nlen||30<n.ndist){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;u<3;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}n.lens[C[n.have++]]=7&d,d>>>=3,u-=3}for(;n.have<19;)n.lens[C[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,k={bits:n.lenbits},x=L(0,n.lens,0,19,n.lencode,0,n.work,k),n.lenbits=k.bits,x){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;w=(S=n.lencode[d&(1<<n.lenbits)-1])>>>16&255,v=65535&S,!((m=S>>>24)<=u);){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}if(v<16)d>>>=m,u-=m,n.lens[n.have++]=v;else{if(16===v){for(A=m+2;u<A;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}if(d>>>=m,u-=m,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}D=n.lens[n.have-1],f=3+(3&d),d>>>=2,u-=2}else if(17===v){for(A=m+3;u<A;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}u-=m,D=0,f=3+(7&(d>>>=m)),d>>>=3,u-=3}else{for(A=m+7;u<A;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}u-=m,D=0,f=11+(127&(d>>>=m)),d>>>=7,u-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;f--;)n.lens[n.have++]=D}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,k={bits:n.lenbits},x=L(V,n.lens,0,n.nlen,n.lencode,0,n.work,k),n.lenbits=k.bits,x){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,k={bits:n.distbits},x=L(I,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,k),n.distbits=k.bits,x){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(6<=s&&258<=l){e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=s,n.hold=d,n.bits=u,z(e,h),o=e.next_out,r=e.output,l=e.avail_out,a=e.next_in,i=e.input,s=e.avail_in,d=n.hold,u=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;w=(S=n.lencode[d&(1<<n.lenbits)-1])>>>16&255,v=65535&S,!((m=S>>>24)<=u);){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}if(w&&0==(240&w)){for(b=m,y=w,_=v;w=(S=n.lencode[_+((d&(1<<b+y)-1)>>b)])>>>16&255,v=65535&S,!(b+(m=S>>>24)<=u);){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}d>>>=b,u-=b,n.back+=b}if(d>>>=m,u-=m,n.back+=m,n.length=v,0===w){n.mode=26;break}if(32&w){n.back=-1,n.mode=12;break}if(64&w){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&w,n.mode=22;case 22:if(n.extra){for(A=n.extra;u<A;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}n.length+=d&(1<<n.extra)-1,d>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;w=(S=n.distcode[d&(1<<n.distbits)-1])>>>16&255,v=65535&S,!((m=S>>>24)<=u);){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}if(0==(240&w)){for(b=m,y=w,_=v;w=(S=n.distcode[_+((d&(1<<b+y)-1)>>b)])>>>16&255,v=65535&S,!(b+(m=S>>>24)<=u);){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}d>>>=b,u-=b,n.back+=b}if(d>>>=m,u-=m,n.back+=m,64&w){e.msg="invalid distance code",n.mode=30;break}n.offset=v,n.extra=15&w,n.mode=24;case 24:if(n.extra){for(A=n.extra;u<A;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}n.offset+=d&(1<<n.extra)-1,d>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===l)break e;if(f=h-l,n.offset>f){if((f=n.offset-f)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}p=f>n.wnext?(f-=n.wnext,n.wsize-f):n.wnext-f,f>n.length&&(f=n.length),g=n.window}else g=r,p=o-n.offset,f=n.length;for(l<f&&(f=l),l-=f,n.length-=f;r[o++]=g[p++],--f;);0===n.length&&(n.mode=21);break;case 26:if(0===l)break e;r[o++]=n.length,l--,n.mode=21;break;case 27:if(n.wrap){for(;u<32;){if(0===s)break e;s--,d|=i[a++]<<u,u+=8}if(h-=l,e.total_out+=h,n.total+=h,h&&(e.adler=n.check=n.flags?F(n.check,r,h,o-h):R(n.check,r,h,o-h)),h=l,(n.flags?d:O(d))!==n.check){e.msg="incorrect data check",n.mode=30;break}u=d=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;u<32;){if(0===s)break e;s--,d+=i[a++]<<u,u+=8}if(d!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}u=d=0}n.mode=29;case 29:x=1;break e;case 30:x=-3;break e;case 31:return-4;case 32:default:return B}return e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=s,n.hold=d,n.bits=u,(n.wsize||h!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&H(e,e.output,e.next_out,h-e.avail_out)?(n.mode=31,-4):(c-=e.avail_in,h-=e.avail_out,e.total_in+=c,e.total_out+=h,n.total+=h,n.wrap&&h&&(e.adler=n.check=n.flags?F(n.check,r,h,e.next_out-h):R(n.check,r,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0===c&&0===h||4===t)&&x===N&&(x=-5),x)},n.inflateEnd=function(e){if(!e||!e.state)return B;var t=e.state;return t.window&&(t.window=null),e.state=null,N},n.inflateGetHeader=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?B:((n.head=t).done=!1,N):B},n.inflateSetDictionary=function(e,t){var n,i=t.length;return e&&e.state?0!==(n=e.state).wrap&&11!==n.mode?B:11===n.mode&&R(1,t,i,0)!==n.check?-3:H(e,t,i,i)?(n.mode=31,-4):(n.havedict=1,N):B},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./inffast":69,"./inftrees":71}],71:[function(e,t,n){var V=e("../utils/common"),I=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],N=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],B=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],P=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,i,r,a,o,s){var l,d,u,c,h,f,p,g,m,w=s.bits,v=0,b=0,y=0,_=0,D=0,x=0,k=0,A=0,S=0,E=0,C=null,T=0,R=new V.Buf16(16),F=new V.Buf16(16),z=null,L=0;for(v=0;v<=15;v++)R[v]=0;for(b=0;b<i;b++)R[t[n+b]]++;for(D=w,_=15;1<=_&&0===R[_];_--);if(_<D&&(D=_),0===_)return r[a++]=20971520,r[a++]=20971520,s.bits=1,0;for(y=1;y<_&&0===R[y];y++);for(D<y&&(D=y),v=A=1;v<=15;v++)if(A<<=1,(A-=R[v])<0)return-1;if(0<A&&(0===e||1!==_))return-1;for(F[1]=0,v=1;v<15;v++)F[v+1]=F[v]+R[v];for(b=0;b<i;b++)0!==t[n+b]&&(o[F[t[n+b]]++]=b);if(f=0===e?(C=z=o,19):1===e?(C=I,T-=257,z=N,L-=257,256):(C=B,z=P,-1),v=y,h=a,k=b=E=0,u=-1,c=(S=1<<(x=D))-1,1===e&&852<S||2===e&&592<S)return 1;for(;;){for(p=v-k,m=o[b]<f?(g=0,o[b]):o[b]>f?(g=z[L+o[b]],C[T+o[b]]):(g=96,0),l=1<<v-k,y=d=1<<x;r[h+(E>>k)+(d-=l)]=p<<24|g<<16|m|0,0!==d;);for(l=1<<v-1;E&l;)l>>=1;if(0!==l?(E&=l-1,E+=l):E=0,b++,0==--R[v]){if(v===_)break;v=t[n+o[b]]}if(D<v&&(E&c)!==u){for(0===k&&(k=D),h+=y,A=1<<(x=v-k);x+k<_&&!((A-=R[x+k])<=0);)x++,A<<=1;if(S+=1<<x,1===e&&852<S||2===e&&592<S)return 1;r[u=E&c]=D<<24|x<<16|h-a|0}}return 0!==E&&(r[h+E]=v-k<<24|64<<16|0),s.bits=D,0}},{"../utils/common":62}],72:[function(e,t,n){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],73:[function(e,t,n){var l=e("../utils/common"),s=0,d=1;function i(e){for(var t=e.length;0<=--t;)e[t]=0}var u=0,o=29,c=256,h=c+1+o,f=30,p=19,m=2*h+1,w=15,r=16,g=7,v=256,b=16,y=17,_=18,D=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],x=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S=new Array(2*(h+2));i(S);var E=new Array(2*f);i(E);var C=new Array(512);i(C);var T=new Array(256);i(T);var R=new Array(o);i(R);var F,z,L,V=new Array(f);function I(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function a(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function N(e){return e<256?C[e]:C[256+(e>>>7)]}function B(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function P(e,t,n){e.bi_valid>r-n?(e.bi_buf|=t<<e.bi_valid&65535,B(e,e.bi_buf),e.bi_buf=t>>r-e.bi_valid,e.bi_valid+=n-r):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function O(e,t,n){P(e,n[2*t],n[2*t+1])}function U(e,t){for(var n=0;n|=1&e,e>>>=1,n<<=1,0<--t;);return n>>>1}function H(e,t,n){var i,r,a=new Array(w+1),o=0;for(i=1;i<=w;i++)a[i]=o=o+n[i-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=U(a[s]++,s))}}function M(e){var t;for(t=0;t<h;t++)e.dyn_ltree[2*t]=0;for(t=0;t<f;t++)e.dyn_dtree[2*t]=0;for(t=0;t<p;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*v]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function j(e){8<e.bi_valid?B(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function G(e,t,n,i){var r=2*t,a=2*n;return e[r]<e[a]||e[r]===e[a]&&i[t]<=i[n]}function W(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&G(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!G(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function q(e,t,n){var i,r,a,o,s=0;if(0!==e.last_lit)for(;i=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],r=e.pending_buf[e.l_buf+s],s++,0===i?O(e,r,t):(O(e,(a=T[r])+c+1,t),0!==(o=D[a])&&P(e,r-=R[a],o),O(e,a=N(--i),n),0!==(o=x[a])&&P(e,i-=V[a],o)),s<e.last_lit;);O(e,v,t)}function Z(e,t){var n,i,r,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=m,n=0;n<l;n++)0!==a[2*n]?(e.heap[++e.heap_len]=d=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(r=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=o[2*r+1]);for(t.max_code=d,n=e.heap_len>>1;1<=n;n--)W(e,a,n);for(r=l;n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],W(e,a,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,a[2*r]=a[2*n]+a[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,a[2*n+1]=a[2*i+1]=r,e.heap[1]=r++,W(e,a,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,i,r,a,o,s,l=t.dyn_tree,d=t.max_code,u=t.stat_desc.static_tree,c=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,g=0;for(a=0;a<=w;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<m;n++)p<(a=l[2*l[2*(i=e.heap[n])+1]+1]+1)&&(a=p,g++),l[2*i+1]=a,d<i||(e.bl_count[a]++,o=0,f<=i&&(o=h[i-f]),s=l[2*i],e.opt_len+=s*(a+o),c&&(e.static_len+=s*(u[2*i+1]+o)));if(0!==g){do{for(a=p-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[p]--,g-=2}while(0<g);for(a=p;0!==a;a--)for(i=e.bl_count[a];0!==i;)d<(r=e.heap[--n])||(l[2*r+1]!==a&&(e.opt_len+=(a-l[2*r+1])*l[2*r],l[2*r+1]=a),i--)}}(e,t),H(a,d,e.bl_count)}function X(e,t,n){var i,r,a=-1,o=t[1],s=0,l=7,d=4;for(0===o&&(l=138,d=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=o,o=t[2*(i+1)+1],++s<l&&r===o||(s<d?e.bl_tree[2*r]+=s:0!==r?(r!==a&&e.bl_tree[2*r]++,e.bl_tree[2*b]++):s<=10?e.bl_tree[2*y]++:e.bl_tree[2*_]++,a=r,d=(s=0)===o?(l=138,3):r===o?(l=6,3):(l=7,4))}function Y(e,t,n){var i,r,a=-1,o=t[1],s=0,l=7,d=4;for(0===o&&(l=138,d=3),i=0;i<=n;i++)if(r=o,o=t[2*(i+1)+1],!(++s<l&&r===o)){if(s<d)for(;O(e,r,e.bl_tree),0!=--s;);else 0!==r?(r!==a&&(O(e,r,e.bl_tree),s--),O(e,b,e.bl_tree),P(e,s-3,2)):s<=10?(O(e,y,e.bl_tree),P(e,s-3,3)):(O(e,_,e.bl_tree),P(e,s-11,7));a=r,d=(s=0)===o?(l=138,3):r===o?(l=6,3):(l=7,4)}}i(V);var K=!1;function Q(e,t,n,i){var r,a,o,s;P(e,(u<<1)+(i?1:0),3),a=t,o=n,s=!0,j(r=e),s&&(B(r,o),B(r,~o)),l.arraySet(r.pending_buf,r.window,a,o,r.pending),r.pending+=o}n._tr_init=function(e){K||(function(){var e,t,n,i,r,a=new Array(w+1);for(i=n=0;i<o-1;i++)for(R[i]=n,e=0;e<1<<D[i];e++)T[n++]=i;for(T[n-1]=i,i=r=0;i<16;i++)for(V[i]=r,e=0;e<1<<x[i];e++)C[r++]=i;for(r>>=7;i<f;i++)for(V[i]=r<<7,e=0;e<1<<x[i]-7;e++)C[256+r++]=i;for(t=0;t<=w;t++)a[t]=0;for(e=0;e<=143;)S[2*e+1]=8,e++,a[8]++;for(;e<=255;)S[2*e+1]=9,e++,a[9]++;for(;e<=279;)S[2*e+1]=7,e++,a[7]++;for(;e<=287;)S[2*e+1]=8,e++,a[8]++;for(H(S,h+1,a),e=0;e<f;e++)E[2*e+1]=5,E[2*e]=U(e,5);F=new I(S,D,c+1,h,w),z=new I(E,x,0,f,w),L=new I(new Array(0),k,0,p,g)}(),K=!0),e.l_desc=new a(e.dyn_ltree,F),e.d_desc=new a(e.dyn_dtree,z),e.bl_desc=new a(e.bl_tree,L),e.bi_buf=0,e.bi_valid=0,M(e)},n._tr_stored_block=Q,n._tr_flush_block=function(e,t,n,i){var r,a,o=0;0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return s;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return d;for(t=32;t<c;t++)if(0!==e.dyn_ltree[2*t])return d;return s}(e)),Z(e,e.l_desc),Z(e,e.d_desc),o=function(e){var t;for(X(e,e.dyn_ltree,e.l_desc.max_code),X(e,e.dyn_dtree,e.d_desc.max_code),Z(e,e.bl_desc),t=p-1;3<=t&&0===e.bl_tree[2*A[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),r=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=r&&(r=a)):r=a=n+5,n+4<=r&&-1!==t?Q(e,t,n,i):4===e.strategy||a===r?(P(e,2+(i?1:0),3),q(e,S,E)):(P(e,4+(i?1:0),3),function(e,t,n,i){var r;for(P(e,t-257,5),P(e,n-1,5),P(e,i-4,4),r=0;r<i;r++)P(e,e.bl_tree[2*A[r]+1],3);Y(e,e.dyn_ltree,t-1),Y(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),q(e,e.dyn_ltree,e.dyn_dtree)),M(e),i&&j(e)},n._tr_tally=function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(T[n]+c+1)]++,e.dyn_dtree[2*N(t)]++),e.last_lit===e.lit_bufsize-1},n._tr_align=function(e){var t;P(e,2,3),O(e,v,S),16===(t=e).bi_valid?(B(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}},{"../utils/common":62}],74:[function(e,t,n){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[10])(10)});var zip,saveAs=saveAs||function(f){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=f.document,p=function(){return f.URL||f.webkitURL||f},g=e.createElementNS("http://www.w3.org/1999/xhtml","a"),m="download"in g,w=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),v=f.webkitRequestFileSystem,b=f.requestFileSystem||v||f.mozRequestFileSystem,a=function(e){(f.setImmediate||f.setTimeout)(function(){throw e},0)},y="application/octet-stream",_=0,D=function(e){setTimeout(function(){"string"==typeof e?p().revokeObjectURL(e):e.remove()},4e4)},x=function(e,t,n){for(var i=(t=[].concat(t)).length;i--;){var r=e["on"+t[i]];if("function"==typeof r)try{r.call(e,n||e)}catch(e){a(e)}}},k=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e},i=function(i,n,e){e||(i=k(i));var r,a,t,o=this,s=i.type,l=!1,d=function(){x(o,"writestart progress write writeend".split(" "))},u=function(){if(a&&w&&"undefined"!=typeof FileReader){var t=new FileReader;return t.onloadend=function(){var e=t.result;a.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),o.readyState=o.DONE,d()},t.readAsDataURL(i),void(o.readyState=o.INIT)}(!l&&r||(r=p().createObjectURL(i)),a)?a.location.href=r:void 0===f.open(r,"_blank")&&w&&(f.location.href=r);o.readyState=o.DONE,d(),D(r)},c=function(e){return function(){if(o.readyState!==o.DONE)return e.apply(this,arguments)}},h={create:!0,exclusive:!1};if(o.readyState=o.INIT,n||(n="download"),m)return r=p().createObjectURL(i),void setTimeout(function(){var e,t;g.href=r,g.download=n,e=g,t=new MouseEvent("click"),e.dispatchEvent(t),d(),D(r),o.readyState=o.DONE});f.chrome&&s&&s!==y&&(t=i.slice||i.webkitSlice,i=t.call(i,0,i.size,y),l=!0),v&&"download"!==n&&(n+=".download"),(s===y||v)&&(a=f),b?(_+=i.size,b(f.TEMPORARY,_,c(function(e){e.root.getDirectory("saved",h,c(function(e){var t=function(){e.getFile(n,h,c(function(n){n.createWriter(c(function(t){t.onwriteend=function(e){a.location.href=n.toURL(),o.readyState=o.DONE,x(o,"writeend",e),D(n)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&u()},"writestart progress write abort".split(" ").forEach(function(e){t["on"+e]=o["on"+e]}),t.write(i),o.abort=function(){t.abort(),o.readyState=o.DONE},o.readyState=o.WRITING}),u)}),u)};e.getFile(n,{create:!1},c(function(e){e.remove(),t()}),c(function(e){e.code===e.NOT_FOUND_ERR?t():u()}))}),u)}),u)):u()},t=i.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return n||(e=k(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(t.abort=function(){this.readyState=this.DONE,x(this,"abort")},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,function(e,t,n){return new i(e,t,n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define([],function(){return saveAs});var infoStr,dirName,fileName,emptyAudio,imageList=[],imageData=[],origin=window.location.origin,setting=null,fetchCount=0,downloadedCount=0,totalCount=0,retryCount=0,failedCount=0,fetchThread=[],progressTable=null,needNumberImages=!1,pagesRange=[],isDownloading=!1,isPausing=!1,isSaving=!1,pageURLsList=[],getAllPagesURLFin=!1,pretitle=document.title,needTitleStatus=!1,delayTime=0,fetchPagesXHR=new XMLHttpRequest,emptyAudioFile="data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU3LjcxLjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAAEAAABVgANTU1NTU1Q0NDQ0NDUFBQUFBQXl5eXl5ea2tra2tra3l5eXl5eYaGhoaGhpSUlJSUlKGhoaGhoaGvr6+vr6+8vLy8vLzKysrKysrX19fX19fX5eXl5eXl8vLy8vLy////////AAAAAExhdmM1Ny44OQAAAAAAAAAAAAAAACQCgAAAAAAAAAVY82AhbwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAALACwAAP/AADwQKVE9YWDGPkQWpT66yk4+zIiYPoTUaT3tnU487uNhOvEmQDaCm1Yz1c6DPjbs6zdZVBk0pdGpMzxF/+MYxA8L0DU0AP+0ANkwmYaAMkOKDDjmYoMtwNMyDxMzDHE/MEsLow9AtDnBlQgDhTx+Eye0GgMHoCyDC8gUswJcMVMABBGj/+MYxBoK4DVpQP8iAtVmDk7LPgi8wvDzI4/MWAwK1T7rxOQwtsItMMQBazAowc4wZMC5MF4AeQAGDpruNuMEzyfjLBJhACU+/+MYxCkJ4DVcAP8MAO9J9THVg6oxRMGNMIqCCTAEwzwwBkINOPAs/iwjgBnMepYyId0PhWo+80PXMVsBFzD/AiwwfcKGMEJB/+MYxDwKKDVkAP8eAF8wMwIxMlpU/OaDPLpNKkEw4dRoBh6qP2FC8jCJQFcweQIPMHOBtTBoAVcwOoCNMYDI0u0Dd8ANTIsy/+MYxE4KUDVsAP8eAFBVpgVVPjdGeTEWQr0wdcDtMCeBgDBkgRgwFYB7Pv/zqx0yQQMCCgKNgonHKj6RRVkxM0GwML0AhDAN/+MYxF8KCDVwAP8MAIHZMDDA3DArAQo3K+TF5WOBDQw0lgcKQUJxhT5sxRcwQQI+EIPWMA7AVBoTABgTgzfBN+ajn3c0lZMe/+MYxHEJyDV0AP7MAA4eEwsqP/PDmzC/gNcwXUGaMBVBIwMEsmB6gaxhVuGkpoqMZMQjooTBwM0+S8FTMC0BcjBTgPwwOQDm/+MYxIQKKDV4AP8WADAzAKQwI4CGPhWOEwCFAiBAYQnQMT+uwXUeGzjBWQVkwTcENMBzA2zAGgFEJfSPkPSZzPXgqFy2h0xB/+MYxJYJCDV8AP7WAE0+7kK7MQrATDAvQRIwOADKMBuA9TAYQNM3AiOSPjGxowgHMKFGcBNMQU1FMy45OS41VVU/31eYM4sK/+MYxKwJaDV8AP7SAI4y1Yq0MmOIADGwBZwwlgIJMztCM0qU5TQPG/MSkn8yEROzCdAxECVMQU1FMy45OS41VTe7Ohk+Pqcx/+MYxMEJMDWAAP6MADVLDFUx+4J6Mq7NsjN2zXo8V5fjVJCXNOhwM0vTCDAxFpMYYQU+RlVMQU1FMy45OS41VVVVVVVVVVVV/+MYxNcJADWAAP7EAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV/+MYxOsJwDWEAP7SAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV/+MYxPMLoDV8AP+eAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV/+MYxPQL0DVcAP+0AFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",ehDownloadRegex={imageURL:[/<a href="(\S+?\/fullimg\.php\?\S+?)"/,/<img id="img" src="(\S+?)"/,/<\/(?:script|iframe)><a[\s\S]+?><img src="(\S+?)"/],nextFetchURL:[/<a id="next"[\s\S]+?href="(\S+?\/s\/\S+?)"/,/<a href="(\S+?\/s\/\S+?)"><img src="https?:\/\/ehgt.org\/g\/n.png"/],preFetchURL:/<div class="sn"><a[\s\S]+?href="(\S+?\/s\/\S+?)"/,nl:/return nl\('([\d-]+)'\)/,fileName:/g\/l.png"\s?\/><\/a><\/div><div>([\s\S]+?) :: /,resFileName:/filename=['"]?([\s\S]+?)['"]?$/m,dangerChars:/[:"*?|<>\/\\\n]/g,pagesRange:/^(\d*(-\d*(\/\d+)?)?\s*,\s*)*\d*(-\d*(\/\d+)?)?$/,pagesURL:/(?:<a href=").+?(?=")/gi,mpvKey:/var imagelist\s*=\s*(\[.+?\]);/,imageLimits:/You are currently at <strong>(\d+)<\/strong> towards a limit of <strong>(\d+)<\/strong>/,pagesLength:/<table class="ptt".+>(\d+)<\/a>.+?<\/table>/,IPBanExpires:/The ban expires in \d+ hours?( and \d+ minutes?)?/,categoryTag:/g\/c\/(\w+)\./},requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,ehDownloadFS={fs:void 0,needFileSystem:!1,initHandler:function(e){ehDownloadFS.fs=e,console.log("[EHD] File System is opened! Name >",e.name),ehDownloadFS.removeAllFiles(e)},errorHandler:function(e){var t="File System Request Error > ";t+=e.name||"Unknown Error",console.error("[EHD] "+t,e.message),console.error(e)},saveAs:function(e,i){void 0!==(e=e||ehDownloadFS.fs)&&e.root.getFile(unsafeWindow.gid+".zip",{},function(e){var t=e.toURL();console.log("[EHD] File URL >",t);var n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download",fileName+(setting["save-as-cbz"]?".cbz":".zip")),n.click(),pushDialog('\n\nNot download or file is broken? <a href="'+t+'" download="'+fileName+(setting["save-as-cbz"]?".cbz":".zip")+'" style="color: #ffffff; font-weight: bold;">Click here to download</a>\n\n'),i||(insertCloseButton(),emptyAudio&&emptyAudio.pause())})},removeFile:function(t,e,n){if(void 0!==(e=e||ehDownloadFS.fs)){var i=function(e){e.isFile?e.remove(function(){console.log("[EHD] File",t,"is removed.")}):e.isDirectory&&e.removeRecursively(function(){console.log("[EHD] Directory",t,"is removed.")})};n?i(t):e.root.getFile(t,{create:!1},i)}},removeAllFiles:function(n){void 0!==(n=n||ehDownloadFS.fs)&&(console.log("[EHD] Request removing all files in File System."),n.root.createReader().readEntries(function(e){if(0!==e.length)for(var t=0;t<e.length;t++)ehDownloadFS.removeFile(e[t],n,!0)},ehDownloadFS.errorHandler))},initCheckerHandler:function(n){console.log("[EHD] File System is opened! Name >",n.name),ehDownloadFS.removeFile(unsafeWindow.gid+".zip",n),n.root.getFile("config.txt",{create:!1},function(e){e.file(function(e){var t=new FileReader;t.onloadend=function(){var e=this.result;if(""!==e&&null!=e){var t=JSON.parse(e);t&&confirm("You have an archive that is not downloaded, save it?\n\nFile Name: "+t.fileName+"\n\n* If you have already downloaded it, click cancel to remove the cached archive file.")?(fileName=t.fileName,dirName=t.dirName,ehDownloadFS.storeTempArchive(t,n)):ehDownloadFS.removeAllFiles(n)}},t.readAsText(e)})})},storeTempArchive:function(r,a){void 0!==(a=a||ehDownloadFS.fs)&&a.root.getDirectory("raw",{},function(e){e.createReader().readEntries(function(e){if(0!==e.length){var t=0,n=new FileReader;zip=new JSZip,ehDownloadDialog.style.display="block",ehDownloadDialog.innerHTML="",pushDialog("Preparing......"),n.onloadend=function(){(r.dirName?zip.folder(r.dirName):zip).file(e[t].name,this.result),++t<e.length?i():(ehDownloadFS.removeAllFiles(),setTimeout(generateZip,3e3,!0,a))};var i=function(){console.log("[EHD] TempArchiveFileIndex >",t,"| TempArchiveFileName >",e[t].name,"| TempArchiveFilePath >",e[t].fullPath,"| TempArchiveFileLength >",e.length),pushDialog("\n"+(t+1)+"/"+e.length),a.root.getFile(e[t].fullPath,{create:!1},function(e){e.file(function(e){n.readAsArrayBuffer(e)})})};i()}},ehDownloadFS.errorHandler)},ehDownloadFS.errorHandler)}},ehDownloadStyle='\t@-webkit-keyframes progress { \t\tfrom { -webkit-transform: translateX(-50%) scaleX(0); transform: translateX(-50%) scaleX(0); } \t\t50% { -webkit-transform: translateX(0%) scaleX(0.7); transform: translateX(0%) scaleX(0.7); } \t\tto { -webkit-transform: translateX(50%) scaleX(0); transform: translateX(50%) scaleX(0); } \t} \t@-moz-keyframes progress { \t\tfrom { -moz-transform: translateX(-50%) scaleX(0); transform: translateX(-50%) scaleX(0); } \t\t50% { -moz-transform: translateX(0%) scaleX(0.7); transform: translateX(0%) scaleX(0.7); } \t\tto { -moz-transform: translateX(50%) scaleX(0); transform: translateX(50%) scaleX(0); } \t} \t@-ms-keyframes progress { \t\tfrom { -ms-transform: translateX(-50%) scaleX(0); transform: translateX(-50%) scaleX(0); } \t\t50% { -ms-transform: translateX(0%) scaleX(0.7); transform: translateX(0%) scaleX(0.7); } \t\tto { -ms-transform: translateX(50%) scaleX(0); transform: translateX(50%) scaleX(0); } \t} \t@keyframes progress { \t\tfrom { -webkit-transform: translateX(-50%) scaleX(0); transform: translateX(-50%) scaleX(0); } \t\t50% { -webkit-transform: translateX(0%) scaleX(0.7); transform: translateX(0%) scaleX(0.7); } \t\tto { -webkit-transform: translateX(50%) scaleX(0); transform: translateX(50%) scaleX(0); } \t} \t.ehD-box { margin: 20px auto; width: 732px; box-sizing: border-box; font-size: 12px; border: 1px groove #000000; }\t.ehD-box a { cursor: pointer; }\t.ehD-box .g2 { display: inline-block; margin: 10px; padding: 0; line-height: 14px; }\t.ehD-box legend { font-weight: 700; padding: 0 10px; } \t.ehD-box legend a { color: inherit; text-decoration: none; }\t.ehD-box input[type="text"] { width: 250px; }\t.ehD-box-extend input[type="text"] { width: 255px; }\t.ehD-setting { position: fixed; left: 0; right: 0; top: 0; bottom: 0; padding: 5px; border: 1px solid #000000; background: #34353b; color: #dddddd; width: 600px; height: 380px; max-width: 100%; max-height: 100%; overflow-x: hidden; overflow-y: auto; box-sizing: border-box; margin: auto; z-index: 999; text-align: left; font-size: 12px; outline: 5px rgba(0, 0, 0, 0.25) solid; }\t.ehD-setting-tab { list-style: none; margin: 5px 0; padding: 0 10px; border-bottom: 1px solid #cccccc; overflow: auto; }\t.ehD-setting-tab li { float: left; padding: 5px 10px; border-bottom: 0; cursor: pointer; }\t.ehD-setting[data-active-setting="basic"] li[data-target-setting="basic"], .ehD-setting[data-active-setting="advanced"] li[data-target-setting="advanced"] { font-weight: bold; background: #cccccc; color: #000000; }\t.ehD-setting-main { overflow: hidden }\t.ehD-setting-wrapper { width: 200%; overflow: hidden; -webkit-transform: translateX(0%); -moz-transform: translateX(0%); -o-transform: translateX(0%); -ms-transform: translateX(0%); transform: translateX(0%); -webkit-transition: all 0.5s cubic-bezier(0.86, 0, 0.07, 1); -moz-transition: all 0.5s cubic-bezier(0.86, 0, 0.07, 1); -o-transition: all 0.5s cubic-bezier(0.86, 0, 0.07, 1); -ms-transition: all 0.5s cubic-bezier(0.86, 0, 0.07, 1); transition: all 0.5s cubic-bezier(0.86, 0, 0.07, 1); }\t.ehD-setting[data-active-setting="advanced"] .ehD-setting-wrapper { -webkit-transform: translateX(-50%); -moz-transform: translateX(-50%); -o-transform: translateX(-50%); -ms-transform: translateX(-50%); transform: translateX(-50%); }\t.ehD-setting-content { width: 50%; float: left; box-sizing: border-box; padding: 5px 10px; height: 295px; max-height: calc(100vh - 85px); overflow: auto; }\t.ehD-setting .g2 { padding-bottom: 10px; }\t.ehD-setting input, .ehD-box input, .ehD-setting select, .ehD-box select { vertical-align: middle; top: 0; margin: 0; }\t.ehD-setting input[type="text"], .ehD-box input[type="text"], .ehD-setting input[type="number"] { height: 18px; padding: 0 0 0 3px; line-height: 18px; border-radius: 3px; }\t.ehD-setting input[type="text"], .ehD-setting input[type="number"] { border: 1px solid #8d8d8d; } \t.ehD-setting input[type="checkbox"] { margin: 3px 3px 4px 0 } \t.ehD-setting select { padding: 0 3px 1px; } \t.ehD-setting-note { border: 1px dashed #999999; padding: 10px 10px 0 10px; }\t.ehD-setting-footer { text-align: center; margin-top: 5px; border-top: 1px solid #cccccc; padding-top: 5px; }\t.ehD-setting sup { vertical-align: top; }\t.ehD-setting a { color: #ffffff; }\t.ehD-box input[type="number"] { height: 17px; }\t.ehD-dialog progress { height: 12px; -webkit-appearance: none; border: 1px solid #4f535b; color: #4f535b; background: #34353b; position: relative; } \t.ehD-dialog progress::-webkit-progress-bar { background: #34353b; } \t.ehD-dialog progress::-webkit-progress-value { background: #4f535b; -webkit-transition: all 0.2s ease; transition: all 0.2s ease; } \t.ehD-dialog progress::-moz-progress-bar { background: #4f535b; -moz-transition: all 0.2s ease; transition: all 0.2s ease; } \t.ehD-dialog progress::-ms-fill { background: #4f535b; -ms-transition: all 0.2s ease; transition: all 0.2s ease; } \t.ehD-dialog progress:not([value])::after { content: ""; will-change: transform; width: 100%; height: 100%; left: 0; top: 0; display: block; background: #4f535b; position: absolute; -webkit-animation: progress 1s cubic-bezier(0.9, 0.4, 0.1, 0.6) alternate infinite; -moz-animation: progress 1s cubic-bezier(0.9, 0.4, 0.1, 0.6) alternate infinite; -ms-animation: progress 1s cubic-bezier(0.9, 0.4, 0.1, 0.6) alternate infinite; animation: progress 1s cubic-bezier(0.9, 0.4, 0.1, 0.6) alternate infinite; } \t.ehD-dialog progress:not([value])::-moz-progress-bar { width: 0px !important; } \t.ehD-pt { table-layout: fixed; width: 100%; }\t.ehD-pt-name { overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }\t.ehD-pt-progress-outer { width: 160px; position: relative; }\t.ehD-pt-progress { width: 150px; }\t.ehD-pt-progress-text { position: absolute; width: 100%; text-align: center; color: #b8b8b8; left: 0; right: 0; }\t.ehD-pt-status { width: 130px; }\t.ehD-pt-succeed .ehD-pt-status { color: #00ff00; }\t.ehD-pt-warning .ehD-pt-status { color: #ffff00; }\t.ehD-pt-failed .ehD-pt-status { color: #ff0000; }\t.ehD-pt-abort { color: #ffff00; display: none; cursor: pointer; }\t.ehD-pt-status[data-inited-abort]:hover .ehD-pt-abort, .ehD-pt-failed .ehD-pt-status[data-inited-abort]:hover .ehD-pt-status-text, .ehD-pt-succeed .ehD-pt-status[data-inited-abort]:hover .ehD-pt-status-text { display: inline; }\t.ehD-pt-status[data-inited-abort]:hover .ehD-pt-status-text, .ehD-pt-failed .ehD-pt-status[data-inited-abort]:hover .ehD-pt-abort, .ehD-pt-succeed .ehD-pt-status[data-inited-abort]:hover .ehD-pt-abort { display: none; }\t.ehD-pt-gen-progress { width: 50%; }\t.ehD-pt-gen-filename { margin-bottom: 1em; }\t.ehD-dialog { position: fixed; right: 0; bottom: 0; display: none; padding: 5px; border: 1px solid #000000; background: #34353b; color: #dddddd; width: 550px; height: 300px; overflow: auto; z-index: 999; word-break: break-all; }\t.ehD-status { position: fixed; right: 0; bottom: 311px; width: 550px; padding: 5px; border: 1px solid #000000; background: #34353b; color: #dddddd; cursor: pointer; -webkit-user-select: none; -moz-user-select: none; -o-user-select: none; -ms-user-select: none; user-select: none; }\t.ehD-dialog, .ehD-status { -webkit-transition: margin 0.5s ease; -moz-transition: margin 0.5s ease; -o-transition: margin 0.5s ease; -ms-transition: margin 0.5s ease; transition: margin 0.5s ease; }\t.ehD-dialog.hidden, .ehD-dialog.hidden .ehD-status { margin-bottom: -311px; }\t.ehD-dialog .ehD-force-download-tips { position: fixed; right: 0; bottom: 288px; border: 1px solid #000000; width: 550px; padding: 5px; background: rgba(0, 0, 0, 0.75); color: #ffffff; cursor: pointer; opacity: 0; pointer-events: none; -webkit-transition: opacity 0.5s ease, bottom 0.5s ease; -moz-transition: opacity 0.5s ease, bottom 0.5s ease; -o-transition: opacity 0.5s ease, bottom 0.5s ease; -ms-transition: opacity 0.5s ease, bottom 0.5s ease; transition: opacity 0.5s ease, bottom 0.5s ease; }\t.ehD-dialog:hover .ehD-force-download-tips { opacity: 1; }\t.ehD-dialog.hidden .ehD-force-download-tips { bottom: -24px; }\t.ehD-close-tips { position: fixed; left: 0; right: 0; bottom: 0; padding: 10px; border: 1px solid #000000; background: #34353b; color: #dddddd; width: 732px; max-width: 100%; max-height: 100%; overflow-x: hidden; overflow-y: auto; box-sizing: border-box; margin: auto; z-index: 1000; text-align: left; font-size: 14px; outline: 5px rgba(0, 0, 0, 0.25) solid; }\t.ehD-feedback { position: absolute; right: 5px; top: 14px; }';function initSetting(){loadSetting().then(function(e){if(setting=e?JSON.parse(e):{},needNumberImages=setting["number-images"],needTitleStatus="always"===setting["status-in-title"],!0===setting["status-in-title"]&&(setting["status-in-title"]="blur"),setting["save-info-list"]||(setting["save-info-list"]=["title","metas","uploader-comment","page-links"]),localStorage.getItem("ehd-image-limits-g.e-hentai.org")&&localStorage.removeItem("ehd-image-limits-g.e-hentai.org"),setting["image-limits-both"]&&(delete setting["image-limits-both"],GM_setValue("ehD-setting",JSON.stringify(setting))),localStorage.getItem("ehd-image-limits-r.e-hentai.org")&&localStorage.removeItem("ehd-image-limits-r.e-hentai.org"),void 0===setting["auto-download-cancel"]&&(setting["auto-download-cancel"]=!0),console.log("[EHD] E-Hentai Downloader Setting >",JSON.stringify(setting)),!1===setting["enable-multi-threading"]&&(delete setting["enable-multi-threading"],alert("Single-thread download is unavailable now, because its code is too old and it's hard to add new features on it.\n\nIf you still need it, please roll back to the last-supported version (1.17.4).\n\nYou can get it at:\n- GitHub: https://github.com/ccloli/E-Hentai-Downloader/releases\n- GreasyFork: https://greasyfork.org/scripts/10379-e-hentai-downloader/versions (requires log in and enable Adult content)\n- SleazyFork: https://sleazyfork.org/scripts/10379-e-hentai-downloader/versions"),GM_setValue("ehD-setting",JSON.stringify(setting))),setting["recheck-file-name"]&&toggleFilenameConfirmInput(),ehDownloadNumberInput.querySelector("input").checked=needNumberImages,ehDownloadPauseBtn.textContent=setting["force-pause"]?"Pause (Downloading images will be aborted)":"Pause (Downloading images will keep downloading)",setting["hide-image-limits"]||(getImageLimits(!0),setInterval(getImageLimits,6e4)),!setting["hide-estimated-cost"])try{showPreCalcCost()}catch(e){}setting["store-in-fs"]&&requestFileSystem&&requestFileSystem(window.TEMPORARY,1073741824,ehDownloadFS.initCheckerHandler,ehDownloadFS.errorHandler)})}function createBlob(t,n){try{return new Blob(t,n)}catch(e){if(pushDialog("An error occurred when generating Blob object."),console.error("[EHD] An error occurred when generating Blob object. Error Name >",e.name,"| Error Message >",e.message),confirm("An error occurred when generating Blob object.\n\nError Name: "+e.name+"\nError Message: "+e.message+"\n\nTry again?"))return createBlob(t,n);throw t=void 0,new Error("[EHD] An error occurred when generating Blob object, and user refused to retry.")}}function pushDialog(e){var t=ehDownloadDialog.clientHeight+ehDownloadDialog.scrollTop>=ehDownloadDialog.scrollHeight;if("string"==typeof e){var n=document.createElement("span");n.innerHTML+=e.replace(/\n/gi,"<br>"),ehDownloadDialog.appendChild(n)}else ehDownloadDialog.appendChild(e);getAllPagesURLFin&&isDownloading&&ehDownloadDialog.contains(ehDownloadPauseBtn)&&ehDownloadDialog.appendChild(ehDownloadPauseBtn),t&&(ehDownloadDialog.scrollTop=ehDownloadDialog.scrollHeight)}function getSafeName(e,t){var n={":":"",'"':"","*":"","?":"","|":"","<":"",">":"","/":"","\\":"","\n":"-"};return e.trim().replace(ehDownloadRegex.dangerChars,function(e){return!t||"/"!==e&&"\\"!==e?setting["replace-with-full-width"]?n[e]:"-":e})}function getReplacedName(e){return e.replace(/\{gid\}/gi,unsafeWindow.gid).replace(/\{token\}/gi,unsafeWindow.token).replace(/\{title\}/gi,getSafeName(document.getElementById("gn").textContent)).replace(/\{subtitle\}/gi,document.getElementById("gj").textContent?getSafeName(document.getElementById("gj").textContent):getSafeName(document.getElementById("gn").textContent)).replace(/\{tag\}/gi,((document.querySelector(".ic").getAttribute("src").match(ehDownloadRegex.categoryTag)||[])[1]||document.querySelector(".ic").getAttribute("alt")).toUpperCase()).replace(/\{uploader\}/gi,getSafeName(document.querySelector("#gdn a").textContent)).replaceHTMLEntites()}function PageData(e,t,n,i,r,a){this.pageURL=e.split("?")[0],this.imageURL=t,this.imageName=getSafeName(n),this._imageName=this.imageName,this.equalCount=1,this.nextNL=i,this.realIndex=r,this.imageNumber=a}function renameImages(){imageList.forEach(function(e,t){if(needNumberImages)e.imageName=e.imageNumber+(setting["number-separator"]?setting["number-separator"]:"")+e.imageName;else for(var n=0;n<t;n++)if(void 0!==e&&void 0!==imageList[n]&&e.imageName.toLowerCase()===imageList[n].imageName.toLowerCase()){var i=e.imageName.split(".");i[i.length-2]+=" ("+ ++imageList[n].equalCount+")",e.imageName=i.join(".");break}})}function storeRes(e,t){for(var n in imageData[t]=e,downloadedCount++,console.log("[EHD] Index >",t+1," | RealIndex >",imageList[t].realIndex," | Name >",imageList[t].imageName," | RetryCount >",retryCount[t]," | DownloadedCount >",downloadedCount," | FetchCount >",fetchCount," | FailedCount >",failedCount),fetchCount--,updateTotalStatus(),isPausing||checkFailed(),e)delete e[n]}function generateZip(u,n,t,c){isSaving=!0,!c&&ehDownloadDialog.contains(ehDownloadPauseBtn)&&ehDownloadDialog.removeChild(ehDownloadPauseBtn),u||t||(0<=setting["save-info-list"].toString().indexOf("page-links")&&imageList.forEach(function(e,t){infoStr+="\n\nPage "+e.realIndex+": "+e.pageURL+"\nImage "+e.realIndex+": "+e.imageName}),pushDialog("\nFinish downloading at "+new Date+"\n"),infoStr+="\n\nDownloaded at "+new Date+"\n\nGenerated by E-Hentai Downloader. https://github.com/ccloli/E-Hentai-Downloader","file"!==setting["save-info"]&&setting["save-info"]||(dirName?zip.folder(dirName):zip).file("info.txt",infoStr.replace(/\n/gi,"\r\n"))),pushDialog("\n\nGenerating Zip file...\n");n=n||ehDownloadFS.fs;var i=document.createElement("progress"),h=document.createElement("div");i.className="ehD-pt-gen-progress",h.className="ehD-pt-gen-filename",h.textContent=" ",ehDownloadDialog.appendChild(i),ehDownloadDialog.appendChild(h),ehDownloadDialog.scrollTop=ehDownloadDialog.scrollHeight;var f=function(r){h.textContent=" ";var t=function(e){ehDownloadFS.errorHandler(e),ehDownloadFS.removeAllFiles(),confirm("An error occured when storing files to FileSystem.\nError Name: "+(e.name||"Unknown Error")+"\nError Message: "+e.message+"\n\nShould I try FileSystem again (Yes) or redirect to try using Blob (No)? \n* If the error message shows there's no more free disk space, try removing some files from the drive where Chrome installed (mostly C: on Windows)")?f(r):(ehDownloadFS.needFileSystem=!1,p(r))},a=a||ehDownloadFS.fs;pushDialog("\n\nSlicing and storing Zip file to FileSystem...");var o=r,s=0,l=o.byteLength,d=function(i){i.createWriter(function(e){if(s=e.length,l<=s)return r=o=void 0,setTimeout(function(){ehDownloadFS.saveAs(u?a:void 0,c),isSaving=!1},1500);e.seek(s);var t=s+10485760;console.log("[EHD] DataIndex >",s,"| DataLastIndex >",t,"| FileWriterLength >",e.length,"| DataLength >",l),pushDialog("\n"+s+"-"+t+"/"+l);var n=createBlob([o.slice(s,t)],{type:"application/zip"});e.write(n),"close"in n&&n.close(),n=null,setTimeout(d,100,i)},t)};a.root.getFile(unsafeWindow.gid+".zip",{create:!0},function(e){e.isFile?e.remove(function(){console.log("[EHD] File",fileName,"is removed.")},t):e.isDirectory&&e.removeRecursively(function(){console.log("[EHD] Directory",fileName,"is removed.")},t),a.root.getFile(unsafeWindow.gid+".zip",{create:!0},d,t)},t)},p=function(e){h.textContent="Generating Blob object...";var t=createBlob([e],{type:setting["save-as-cbz"]?"application/vnd.comicbook+zip":"application/zip"});saveAs(t,fileName+(setting["save-as-cbz"]?".cbz":".zip"));var n=document.createElement("button");n.textContent="Not download? Click here to download",n.addEventListener("click",function(){t=createBlob([e],{type:setting["save-as-cbz"]?"application/vnd.comicbook+zip":"application/zip"}),saveAs(t,fileName+(setting["save-as-cbz"]?".cbz":".zip")),setTimeout(function(){"close"in t&&t.close(),t=null},1e4)}),ehDownloadDialog.appendChild(n),c||insertCloseButton(),isSaving=!1,setTimeout(function(){"close"in t&&t.close(),t=null},1e4)};try{var r=0;zip.generateAsync({type:"arraybuffer",compression:setting["compression-level"]?"DEFLATE":"STORE",compressionOptions:{level:0<setting["compression-level"]?setting["compression-level"]<10?setting["compression-level"]:9:1},streamFiles:!!setting["file-descriptor"],comment:"comment"===setting["save-info"]?infoStr.replace(/\n/gi,"\r\n"):void 0},function(e){var t=Date.now();t-r<300||(r=t,i.value=e.percent/100,h.textContent=e.currentFile||"Calculating extra data...")}).then(function(e){i.value=1,c||emptyAudio&&emptyAudio.pause(),u||ehDownloadFS.needFileSystem?f(e):p(e),c||zip.file(/.*/).forEach(function(e){zip.remove(e)})})}catch(e){if(abData=void 0,pushDialog("An error occurred when generating Zip file as ArrayBuffer."),console.error("[EHD] An error occurred when generating Zip file as ArrayBuffer."),console.error(e),confirm("An error occurred when generating Zip file as ArrayBuffer. Try again?"))return generateZip(u,n,1);var a=function(e){ehDownloadFS.errorHandler(e),ehDownloadFS.removeAllFiles(),confirm("An error occured when storing files to FileSystem.\nError Name: "+(e.name||"Unknown Error")+"\nError Message: "+e.message+"\n\nShould I try again (Yes) or stop it (No, and the downloaded file will be removed)? \n* If the error message shows there's no more free disk space, try removing some files from the drive where Chrome installed (mostly C: on Windows)")&&generateZip(u,n,t,c)};if(u||ehDownloadFS.needFileSystem){pushDialog("Storing files into File System...");var o=zip.file(/.*/),s=0,l=o.length,d=function(e){(n=e).root.getDirectory("raw",{create:!0},g,a)},g=function(){n.root.getFile("raw/"+o[s].name,{create:!0},function(e){e.createWriter(function(e){console.log("[EHD] FileIndex >",s,"| FilesLength >",l);var t=createBlob([o[s].asArrayBuffer()],{type:"application/octet-stream"});e.write(t),"close"in t&&t.close(),t=null,++s<l?setTimeout(g,100):n.root.getFile("config.txt",{create:!0},function(e){e.createWriter(function(e){var t=createBlob([JSON.stringify({fileName:fileName,dirName:dirName})],{type:"text/plain"});e.write(t),"close"in t&&t.close(),t=null,pushDialog('Success!\nPlease close this tab and open a new tab to download.\nIf you still can\'t download it, try using <a href="https://chrome.google.com/webstore/detail/nhnjmpbdkieehidddbaeajffijockaea" target="_blank">HTML5 FileSystem Explorer</a> to save them.'),o.forEach(function(e){zip.remove(e)}),zip=void 0,isSaving=!1})})},a)},a)};requestFileSystem(window.TEMPORARY,1099511627776,d,a)}}}function updateProgress(e,t){void 0!==t.name&&(e.fileName.textContent=t.name),void 0!==t.progress&&(e.progress.value=t.progress),void 0!==t.progressText&&(e.progressText.textContent=t.progressText),void 0!==t.status&&(e.statusText.textContent=t.status),void 0!==t.class&&(e.current.className=["ehD-pt-item",t.class].join(" ").trim())}function updateTotalStatus(){ehDownloadStatus.textContent="Total: "+totalCount+" | Downloading: "+fetchCount+" | Succeed: "+downloadedCount+" | Failed: "+failedCount,needTitleStatus&&(document.title="["+(isPausing?"":downloadedCount<totalCount?" "+downloadedCount+"/"+totalCount:0===totalCount?"":"")+"] "+pretitle)}function failedFetching(e,t,n){!isDownloading||imageData[e]instanceof ArrayBuffer||(void 0!==fetchThread[e]&&"abort"in fetchThread[e]&&fetchThread[e].abort(),console.error("[EHD] Index >",e+1," | RealIndex >",imageList[e].realIndex," | Name >",imageList[e].imageName," | RetryCount >",retryCount[e]," | DownloadedCount >",downloadedCount," | FetchCount >",fetchCount," | FailedCount >",failedCount),!n&&retryCount[e]<(void 0!==setting["retry-count"]?setting["retry-count"]:3)?(retryCount[e]++,fetchOriginalImage(e,t)):(updateProgress(t,{class:"ehD-pt-failed"}),imageList[e].imageFinalURL=null,failedCount++,isPausing&&setting["force-pause"]||fetchCount--,updateTotalStatus(),checkFailed()))}function saveDownloaded(e){renameImages();for(var t=0;t<imageData.length;t++)null!=imageData[t]&&"Fetching"!==imageData[t]&&((dirName?zip.folder(dirName):zip).file(imageList[t].imageName,imageData[t]),e||(imageData[t]=null));generateZip(!1,void 0,!1,e),e&&imageList.forEach(function(e,t){e.equalCount=1,e.imageName=e._imageName})}function checkFailed(){if(downloadedCount+failedCount<totalCount)requestDownload();else if(0<failedCount){if(0===fetchCount){for(var e=0;e<fetchThread.length;e++)void 0!==fetchThread[e]&&"abort"in fetchThread[e]&&fetchThread[e].abort();setting["number-auto-retry"]||confirm("Some images failed to download. Would you like to try them again?")?retryAllFailed():(pushDialog("\nFetch images failed."),setting["auto-download-cancel"]||confirm("Fetch images failed, Please try again later.\n\nWould you like to download downloaded images?")?saveDownloaded():insertCloseButton(),zip.file(/.*/).forEach(function(e){zip.remove(e)}),isDownloading=!1)}}else{renameImages();for(var t=0;t<totalCount;t++)(dirName?zip.folder(dirName):zip).file(imageList[t].imageName,imageData.shift());generateZip(),zip.file(/.*/).forEach(function(e){zip.remove(e)}),isDownloading=!1}}function fetchOriginalImage(u,c){if(void 0===retryCount[u]&&(retryCount[u]=0),!isPausing){var h=imageList[u].imageFinalURL||imageList[u].imageURL,e=ehDownloadDialog.clientHeight+ehDownloadDialog.scrollTop>=ehDownloadDialog.scrollHeight;if(void 0===c){var t=progressTable.querySelector('tr[data-index="'+u+'"]');t||((t=document.createElement("tr")).className="ehD-pt-item",t.setAttribute("data-index",u),t.innerHTML='\t\t\t\t<td class="ehD-pt-name">#'+imageList[u].realIndex+": "+imageList[u].imageName+'</td>\t\t\t\t<td class="ehD-pt-progress-outer">\t\t\t\t\t<progress class="ehD-pt-progress"></progress>\t\t\t\t\t<span class="ehD-pt-progress-text"></span>\t\t\t\t</td>\t\t\t\t<td class="ehD-pt-status">\t\t\t\t\t<span class="ehD-pt-status-text">Pending...</span>\t\t\t\t\t<span class="ehD-pt-abort">Force Abort</span>\t\t\t\t</td>',progressTable.appendChild(t)),c={current:t,fileName:t.getElementsByTagName("td")[0],status:t.getElementsByTagName("td")[2],statusText:t.getElementsByClassName("ehD-pt-status-text")[0],progress:t.getElementsByTagName("progress")[0],progressText:t.getElementsByTagName("span")[0],abort:t.getElementsByClassName("ehD-pt-abort")[0]}}var a={lastProgress:0,lastTimestamp:(new Date).getTime(),zeroDetect:null,expiredDetect:null};e&&(ehDownloadDialog.scrollTop=ehDownloadDialog.scrollHeight);var o=function(e){imageData[u]instanceof ArrayBuffer?updateProgress(c,{name:"#"+imageList[u].realIndex+": "+imageList[u].imageName,status:"Succeed!",progress:"1",progressText:"100%",class:"ehD-pt-succeed"}):isDownloading&&(isPausing&&setting["force-pause"]||(updateProgress(c,{progressText:"0 KB/s"}),setting["speed-detect"]&&null===a.expiredDetect&&(a.expiredDetect=setTimeout(s,1e3*(setting["speed-expired"]?setting["speed-expired"]:30),e))))},s=function(e){if(imageData[u]instanceof ArrayBuffer)updateProgress(c,{name:"#"+imageList[u].realIndex+": "+imageList[u].imageName,status:"Succeed!",progress:"1",progressText:"100%",class:"ehD-pt-succeed"});else if(isDownloading&&(!isPausing||!setting["force-pause"])){for(var t in void 0!==fetchThread[u]&&"abort"in fetchThread[u]&&fetchThread[u].abort(),console.log("[EHD] #"+(u+1)+": Speed Too Low"),console.log("[EHD] #"+(u+1)+": RealIndex >",imageList[u].realIndex," | ReadyState >",e.readyState," | Status >",e.status," | StatusText >",e.statusText+"\nRequest URL >",h,"\nFinal URL >",e.finalUrl,"\nResposeHeaders >"+e.responseHeaders),updateProgress(c,{status:"Failed! (Low Speed)",progress:"0",progressText:"",class:"ehD-pt-warning"}),0<=imageList[u].imageURL.indexOf("fullimg.php")&&(imageList[u].imageFinalURL=e.finalUrl),e)delete e[t];failedFetching(u,c)}},f=function(){null!==a.expiredDetect&&(clearTimeout(a.expiredDetect),a.expiredDetect=null),null!==a.zeroDetect&&(clearTimeout(a.zeroDetect),a.zeroDetect=null)};fetchThread[u]=GM_xmlhttpRequest({method:"GET",url:h,responseType:"arraybuffer",timeout:void 0!==setting.timeout?1e3*Number(setting.timeout):3e5,headers:{Referer:imageList[u].pageURL,"X-Alt-Referer":imageList[u].pageURL},onprogress:function(e){var t,n=(new Date).getTime(),i=e.lengthComputable?Number((e.loaded-a.lastProgress)/(n-a.lastTimestamp)/1.024):-1;if((1e3<=n-a.lastTimestamp||0===a.lastProgress)&&(t=e.lengthComputable?i.toFixed(2)+" KB/s":"",a.lastProgress=e.loaded,a.lastTimestamp=n),updateProgress(c,{name:"#"+imageList[u].realIndex+": "+imageList[u].imageName,progress:e.lengthComputable?e.loaded/e.total:"",progressText:t,class:"",status:0===retryCount[u]?"Downloading...":"Retrying ("+retryCount[u]+"/"+(void 0!==setting["retry-count"]?setting["retry-count"]:3)+") ..."}),null!==a.zeroDetect&&(clearTimeout(a.zeroDetect),a.zeroDetect=null),a.zeroDetect=setTimeout(o,3e3,e),setting["speed-detect"])if(i>=setting["speed-min"]&&!setting["speed-min"])null===a.expiredDetect&&(a.expiredDetect=setTimeout(s,1e3*(setting["speed-expired"]?setting["speed-expired"]:30),e),console.log("[EHD] Speed detect handler is inited for",u+1,"!"));else for(var r in null!==a.expiredDetect&&(clearTimeout(a.expiredDetect),a.expiredDetect=null),e)delete e[r]},onload:function(t){try{if(f(),!isDownloading||imageData[u]instanceof ArrayBuffer)return;var e=t.response,n=e.byteLength,i=t.responseHeaders,r=i.match(/Content-Type:/i)?i.split(/Content-Type:/i)[1].split("\n")[0].trim().split("/"):["",""];if(!e){for(var a in console.log("[EHD] #"+(u+1)+": Empty Response (See: https://github.com/ccloli/E-Hentai-Downloader/issues/16 )"),console.log("[EHD] #"+(u+1)+": RealIndex >",imageList[u].realIndex," | ReadyState >",t.readyState," | Status >",t.status," | StatusText >",t.statusText+"\nRequest URL >",h,"\nFinal URL >",t.finalUrl,"\nResposeHeaders >"+t.responseHeaders),updateProgress(c,{status:"Failed! (Empty Response)",progress:"0",progressText:"",class:"ehD-pt-warning"}),t)delete t[a];return failedFetching(u,c)}if(925===n){for(var a in console.log("[EHD] #"+(u+1)+": 403 Access Denied"),console.log("[EHD] #"+(u+1)+": RealIndex >",imageList[u].realIndex," | ReadyState >",t.readyState," | Status >",t.status," | StatusText >",t.statusText+"\nRequest URL >",h,"\nFinal URL >",t.finalUrl,"\nResposeHeaders >"+t.responseHeaders),updateProgress(c,{status:"Failed! (Error 403)",progress:"0",progressText:"",class:"ehD-pt-warning"}),t)delete t[a];return failedFetching(u,c,!0)}if(28===n){for(var a in console.log("[EHD] #"+(u+1)+": An error has occurred. (403)"),console.log("[EHD] #"+(u+1)+": RealIndex >",imageList[u].realIndex," | ReadyState >",t.readyState," | Status >",t.status," | StatusText >",t.statusText+"\nRequest URL >",h,"\nFinal URL >",t.finalUrl,"\nResposeHeaders >"+t.responseHeaders),updateProgress(c,{status:"Failed! (Error 403)",progress:"0",progressText:"",class:"ehD-pt-warning"}),t)delete t[a];return failedFetching(u,c,!0)}if(142===n||144===n||28658===n||"text"===r[0]&&0<=(t.responseText||(new TextDecoder).decode(new DataView(e))).indexOf("You have exceeded your image viewing limits")){for(var a in console.log("[EHD] #"+(u+1)+": Exceed Image Viewing Limits / 509 Bandwidth Exceeded"),console.log("[EHD] #"+(u+1)+": RealIndex >",imageList[u].realIndex," | ReadyState >",t.readyState," | Status >",t.status," | StatusText >",t.statusText+"\nRequest URL >",h,"\nFinal URL >",t.finalUrl,"\nResposeHeaders >"+t.responseHeaders),updateProgress(c,{status:"Failed! (Exceed Limits)",progress:"0",progressText:"",class:"ehD-pt-failed"}),t)delete t[a];if(failedCount++,fetchCount--,updateTotalStatus(),isPausing)return;pushDialog("You have exceeded your image viewing limits.\n"),isPausing=!0,updateTotalStatus(),emptyAudio&&emptyAudio.pause(),ehDownloadDialog.contains(ehDownloadPauseBtn)&&ehDownloadDialog.removeChild(ehDownloadPauseBtn),confirm("You have temporarily reached the limit for how many images you can browse.\n\n\t\t\t\t\t\t- If you are not signed in, sign up/in with an E-Hentai account at E-Hentai Forums to get double daily quota.\n\t\t\t\t\t\t- You can run Hentai@Home to support E-Hentai and get some points which you can pay to increase your limit.\n\t\t\t\t\t\t- Check back in a few hours, and you will be able to download more (3 points are reduced per minute by default).\n\t\t\t\t\t\t- You can reset your image viewing limits to continue by paying your GPs or credits.\n\n\t\t\t\t\t\tIf you want to reset your limits by paying your GPs or credits right now, choose YES, and you can reset it in the opened window. Or if you want to wait a few minutes until you have enough free limit, then continue, choose NO.")&&window.open("https://e-hentai.org/home.php");var o=document.createElement("a");o.innerHTML="<button>Reset Limits</button>",o.setAttribute("href","https://e-hentai.org/home.php"),o.setAttribute("target","_blank"),ehDownloadDialog.appendChild(o),(s=document.createElement("button")).innerHTML="Continue Download",s.addEventListener("click",function(){ehDownloadDialog.removeChild(o),ehDownloadDialog.removeChild(s),ehDownloadDialog.removeChild(l),ehDownloadDialog.appendChild(ehDownloadPauseBtn),isPausing=!1,initProgressTable(),requestDownload()}),ehDownloadDialog.appendChild(s),(l=document.createElement("button")).innerHTML="Cancel Download",l.addEventListener("click",function(){ehDownloadDialog.removeChild(o),ehDownloadDialog.removeChild(s),ehDownloadDialog.removeChild(l),setting["auto-download-cancel"]||confirm("You have exceeded your image viewing limits. Would you like to save downloaded images?")?saveDownloaded():insertCloseButton(),isDownloading=isPausing=!1,zip.file(/.*/).forEach(function(e){zip.remove(e)})}),ehDownloadDialog.appendChild(l)}else if("text"===r[0]&&0<=(t.responseText||(new TextDecoder).decode(new DataView(e))).indexOf("Your IP address has been temporarily banned")){for(var a in console.log("[EHD] #"+(u+1)+": IP address banned"),console.log("[EHD] #"+(u+1)+": RealIndex >",imageList[u].realIndex," | ReadyState >",t.readyState," | Status >",t.status," | StatusText >",t.statusText+"\nRequest URL >",h,"\nFinal URL >",t.finalUrl,"\nResposeHeaders >"+t.responseHeaders),updateProgress(c,{status:"Failed! (IP banned)",progress:"0",progressText:"",class:"ehD-pt-failed"}),t)delete t[a];if(failedCount++,fetchCount--,updateTotalStatus(),isPausing)return;pushDialog("Your IP address has been temporarily banned.\n"),isPausing=!0,updateTotalStatus(),emptyAudio&&emptyAudio.pause(),ehDownloadDialog.contains(ehDownloadPauseBtn)&&ehDownloadDialog.removeChild(ehDownloadPauseBtn);var s,l,d=(t.responseText||(new TextDecoder).decode(new DataView(e))).match(ehDownloadRegex.IPBanExpires);alert("Your IP address has been temporarily banned. \n\n\t\t\t\t\t\tMake sure your download settings are not configured to download too fast. If you are using conservative rules, check if your computer is infected with malware, or if you are using a shared IP with others.\n\t\t\t\t\t\tIf you can change your IP (like using a proxy) or wait until you're unblocked, you can then continue your download; or cancel your download and get downloaded images.\n\n"+(d?"\n"+d[0]:"")),(s=document.createElement("button")).innerHTML="Continue Download",s.addEventListener("click",function(){ehDownloadDialog.removeChild(s),ehDownloadDialog.removeChild(l),ehDownloadDialog.appendChild(ehDownloadPauseBtn),isPausing=!1,initProgressTable(),requestDownload()}),ehDownloadDialog.appendChild(s),(l=document.createElement("button")).innerHTML="Cancel Download",l.addEventListener("click",function(){ehDownloadDialog.removeChild(s),ehDownloadDialog.removeChild(l),setting["auto-download-cancel"]||confirm("Would you like to save downloaded images?")?saveDownloaded():insertCloseButton(),isDownloading=isPausing=!1,zip.file(/.*/).forEach(function(e){zip.remove(e)})}),ehDownloadDialog.appendChild(l)}else{if(200!==t.status){for(var a in console.log("[EHD] #"+(u+1)+": Wrong Response Status"),console.log("[EHD] #"+(u+1)+": RealIndex >",imageList[u].realIndex," | ReadyState >",t.readyState," | Status >",t.status," | StatusText >",t.statusText+"\nRequest URL >",h,"\nFinal URL >",t.finalUrl,"\nResposeHeaders >"+t.responseHeaders),updateProgress(c,{status:"Failed! (Wrong Status)",progress:"0",progressText:"",class:"ehD-pt-warning"}),t)delete t[a];return failedFetching(u,c)}if("image"!==r[0]){for(var a in console.log("[EHD] #"+(u+1)+": Wrong Content-Type"),console.log("[EHD] #"+(u+1)+": RealIndex >",imageList[u].realIndex," | ReadyState >",t.readyState," | Status >",t.status," | StatusText >",t.statusText+"\nRequest URL >",h,"\nFinal URL >",t.finalUrl,"\nResposeHeaders >"+t.responseHeaders),updateProgress(c,{status:"Failed! (Wrong MIME)",progress:"0",progressText:"",class:"ehD-pt-warning"}),t)delete t[a];return failedFetching(u,c)}}try{imageList[u]._imageName=imageList[u].imageName=t.responseHeaders.match(ehDownloadRegex.resFileName)?getSafeName(t.responseHeaders.match(ehDownloadRegex.resFileName)[1].trim()):imageList[u].imageName}catch(e){console.log("[EHD] #"+(u+1)+": Parse file name failed"),console.log("[EHD] #"+(u+1)+": RealIndex >",imageList[u].realIndex," | ReadyState >",t.readyState," | Status >",t.status," | StatusText >",t.statusText+"\nRequest URL >",h,"\nFinal URL >",t.finalUrl,"\nResposeHeaders >"+t.responseHeaders),imageList[u]._imageName=imageList[u].imageName}for(var a in updateProgress(c,{name:"#"+imageList[u].realIndex+": "+imageList[u].imageName,status:"Succeed!",progress:"1",progressText:"100%",class:"ehD-pt-succeed"}),storeRes(e,u),t)delete t[a];e=null}catch(e){for(var a in console.log("[EHD] #"+(u+1)+": Unknown Error (Please send feedback)"),console.log("[EHD] #"+(u+1)+": RealIndex >",imageList[u].realIndex," | ReadyState >",t.readyState," | Status >",t.status," | StatusText >",t.statusText+"\nRequest URL >",h,"\nFinal URL >",t.finalUrl,"\nResposeHeaders >"+t.responseHeaders),console.log(e),updateProgress(c,{status:"Failed! (Unknown)",progress:"0",progressText:"",class:"ehD-pt-failed"}),t)delete t[a];return failedFetching(u,c)}},onerror:function(e){if(f(),isDownloading&&!(imageData[u]instanceof ArrayBuffer)){for(var t in console.log("[EHD] #"+(u+1)+": Network Error"),console.log("[EHD] #"+(u+1)+": RealIndex >",imageList[u].realIndex," | ReadyState >",e.readyState," | Status >",e.status," | StatusText >",e.statusText+"\nRequest URL >",h,"\nFinal URL >",e.finalUrl,"\nResposeHeaders >"+e.responseHeaders),updateProgress(c,{status:"Failed! (Network Error)",progress:"0",progressText:"",class:"ehD-pt-warning"}),0<=imageList[u].imageURL.indexOf("fullimg.php")&&(imageList[u].imageFinalURL=e.finalUrl),e)delete e[t];failedFetching(u,c)}},ontimeout:function(e){if(f(),isDownloading&&!(imageData[u]instanceof ArrayBuffer)){for(var t in console.log("[EHD] #"+(u+1)+": Timed Out"),console.log("[EHD] #"+(u+1)+": RealIndex >",imageList[u].realIndex," | ReadyState >",e.readyState," | Status >",e.status," | StatusText >",e.statusText+"\nRequest URL >",h,"\nFinal URL >",e.finalUrl,"\nResposeHeaders >"+e.responseHeaders),updateProgress(c,{status:"Failed! (Timed Out)",progress:"0",progressText:"",class:"ehD-pt-warning"}),0<=imageList[u].imageURL.indexOf("fullimg.php")&&(imageList[u].imageFinalURL=e.finalUrl),e)delete e[t];failedFetching(u,c)}}}),"2"!==c.status.dataset.initedAbort&&(c.abort.addEventListener("click",function(){!isDownloading||imageData[u]instanceof ArrayBuffer||f()}),c.status.setAttribute("data-inited-abort","2")),updateTotalStatus()}}function retryAllFailed(){var e;for(initProgressTable(),e=0;e<imageData.length;e++)"Fetching"===imageData[e]&&(imageData[e]=null,retryCount[e]=0);fetchCount=failedCount=0,requestDownload()}function insertCloseButton(){var e=document.createElement("button");e.style.display="block",e.style.margin="0 auto",e.textContent="Close",e.onclick=function(){ehDownloadDialog.removeChild(e),ehDownloadDialog.style.display="none",ehDownloadFS.needFileSystem&&ehDownloadFS.removeFile(unsafeWindow.gid+".zip")},ehDownloadDialog.appendChild(e),ehDownloadDialog.scrollTop=ehDownloadDialog.scrollHeight,ehDownloadDialog.contains(forceDownloadTips)&&ehDownloadDialog.removeChild(forceDownloadTips)}function getPagesURLFromMPV(){var n=location.origin+"/mpv/"+unsafeWindow.gid+"/"+unsafeWindow.token+"/",i=new XMLHttpRequest;i.open("GET",n),i.onload=function(){if(200===i.status&&i.responseText){var e=i.responseText.match(ehDownloadRegex.mpvKey);if(!e)return console.error("[EHD] Response content is incorrect!"),void(retryCount<(void 0!==setting["retry-count"]?setting["retry-count"]:3)?(pushDialog("Failed! Retrying... "),retryCount++,i.open("GET",location.origin+location.pathname+"?p="+curPage),i.timeout=3e4,i.send()):(pushDialog("Failed!\nCan't get pages URL from response content."),isDownloading=!1));new Function("return "+e[1])().forEach(function(e,t){var n=location.origin+"/s/"+e.k+"/"+unsafeWindow.gid+"-"+(t+1);pageURLsList.push(n)}),pushDialog("Succeed!"),getAllPagesURLFin=!0;var t=pagesRange.filter(function(e){return e>pageURLsList.length});if(0!==t.length&&(pagesRange=pagesRange.filter(function(e){return e<=pageURLsList.length}),pushDialog("\nPage "+t.join(", ")+(1<t.length?" are":" is")+" not exist, and will be ignored.\n"),0===pagesRange.length))return pushDialog("Nothing matches provided pages range, stop downloading."),alert("Nothing matches provided pages range, stop downloading."),void insertCloseButton();totalCount=pagesRange.length||pageURLsList.length,pushDialog("\n\n"),initProgressTable(),requestDownload()}else retryCount<(void 0!==setting["retry-count"]?setting["retry-count"]:3)?(pushDialog("Failed! Retrying... "),retryCount++,i.open("GET",n),i.timeout=3e4,i.send()):(pushDialog("Failed!\nFetch Pages' URL failed, Please try again later."),isDownloading=!1,alert("Fetch Pages' URL failed, Please try again later."))},i.send(),pushDialog("Fetching Gallery Pages URL From MPV...")}function getAllPagesURL(){pagesRange=[];var e=ehDownloadRange.querySelector("input").value.replace(//g,",").trim(),i=0;if(e){if(console.log("[EHD] Pages Range >",e),!ehDownloadRegex.pagesRange.test(e))return alert("The format of Pages Range is incorrect.");for(var t,n=/(?:(\d*)-(\d*))(?:\/(\d+))?|(\d+)/g;t=n.exec(e);){var r=Number(t[4]);if(isNaN(r)){var a=Number(t[1])||1,o=Number(t[2])||getFileSizeAndLength().page;if(o<a){var s=a;a=o,o=s}for(var l=Number(t[3])||1,d=a;d<=o;d+=l)pagesRange.push(d)}else pagesRange.push(r)}pagesRange.sort(function(e,t){return e-t}),pagesRange=pagesRange.filter(function(e,t,n){return 0==t||e!=n[t-1]})}if(ehDownloadDialog.style.display="block",getAllPagesURLFin){var u=pagesRange.filter(function(e){return e>pageURLsList.length});if(0!==u.length&&(pagesRange=pagesRange.filter(function(e){return e<=pageURLsList.length}),pushDialog("\nPage "+u.join(", ")+(1<u.length?" are":" is")+" not exist, and will be ignored.\n"),0===pagesRange.length))return pushDialog("Nothing matches provided pages range, stop downloading."),alert("Nothing matches provided pages range, stop downloading."),void insertCloseButton();totalCount=pagesRange.length||pageURLsList.length,pushDialog("\n\n"),initProgressTable(),requestDownload()}else{var c;pageURLsList=[];try{c=[].reduce.call(document.querySelectorAll(".ptt td"),function(e,t){var n=Number(t.textContent);return isNaN(n)?e:n<e?e:n})}catch(e){}var h=0;i=0;var f=fetchPagesXHR;f.onload=function(){if(200===f.status&&f.responseText){var e=f.responseText.split('<div id="gdt">')[1].split('<div class="c">')[0].match(ehDownloadRegex.pagesURL);if(!e)return console.error("[EHD] Response content is incorrect!"),void(i<(void 0!==setting["retry-count"]?setting["retry-count"]:3)?(pushDialog("Failed! Retrying... "),i++,f.open("GET",location.origin+location.pathname+"?p="+h),f.timeout=3e4,f.send()):(pushDialog("Failed!\nCan't get pages URL from response content."),isDownloading=!1));if(0<=e[0].indexOf("/mpv/"))return console.log("[EHD] Page 1 URL > "+e[0]+" , use MPV fetch"),pushDialog("Pages URL is MPV link\n"),void getPagesURLFromMPV();for(var t=0;t<e.length;t++)pageURLsList.push(e[t].split('"')[1].replaceHTMLEntites());if(pushDialog("Succeed!"),h++,c||(c=f.responseText.match(ehDownloadRegex.pagesLength)[1]-0),h===c){getAllPagesURLFin=!0;var n=pagesRange.filter(function(e){return e>pageURLsList.length});if(0!==n.length&&(pagesRange=pagesRange.filter(function(e){return e<=pageURLsList.length}),pushDialog("\nPage "+n.join(", ")+(1<n.length?" are":" is")+" not exist, and will be ignored.\n"),0===pagesRange.length))return pushDialog("Nothing matches provided pages range, stop downloading."),alert("Nothing matches provided pages range, stop downloading."),void insertCloseButton();totalCount=pagesRange.length||pageURLsList.length,pushDialog("\n\n"),initProgressTable(),requestDownload()}else f.open("GET",location.origin+location.pathname+"?p="+h),f.send(),pushDialog("\nFetching Gallery Pages URL ("+(h+1)+"/"+c+") ... ")}else i<(void 0!==setting["retry-count"]?setting["retry-count"]:3)?(pushDialog("Failed! Retrying... "),i++,f.open("GET",location.origin+location.pathname+"?p="+h),f.timeout=3e4,f.send()):(pushDialog("Failed!\nFetch Pages' URL failed, Please try again later."),isDownloading=!1,alert("Fetch Pages' URL failed, Please try again later."))},f.ontimeout=f.onerror=function(){i<(void 0!==setting["retry-count"]?setting["retry-count"]:3)?(pushDialog("Failed! Retrying... "),i++,f.open("GET",location.origin+location.pathname+"?p="+h),f.timeout=3e4,f.send()):(pushDialog("Failed!\nFetch Pages' URL failed, Please try again later."),isDownloading=!1,alert("Fetch Pages' URL failed, Please try again later."))},f.open("GET",location.origin+location.pathname+"?p="+h),f.timeout=3e4,f.send(),pushDialog("\nFetching Gallery Pages URL ("+(h+1)+"/"+(c||"?")+") ... ")}}function initEHDownload(){for(var t=0;t<fetchThread.length;t++)void 0!==fetchThread[t]&&"abort"in fetchThread[t]&&fetchThread[t].abort();if(imageList=[],imageData=[],fetchThread=[],downloadedCount=fetchCount=failedCount=0,isPausing=!(retryCount=[]),zip=new JSZip,infoStr="",fetchPagesXHR.abort(),setting["recheck-file-name"]){var n=document.querySelector(".ehD-box-extend-dirname"),i=document.querySelector(".ehD-box-extend-filename");dirName=n&&n.value?getSafeName(n.value,!0):getReplacedName(setting["dir-name"]?setting["dir-name"]:"{gid}_{token}"),fileName=i&&i.value?getSafeName(i.value):getReplacedName(setting["file-name"]?setting["file-name"]:"{title}")}else dirName=getReplacedName(setting["dir-name"]?setting["dir-name"]:"{gid}_{token}"),fileName=getReplacedName(setting["file-name"]?setting["file-name"]:"{title}");"/"===dirName.trim()&&(dirName=""),needNumberImages=ehDownloadNumberInput.querySelector("input").checked;var r=Math.ceil(getFileSizeAndLength().size+102400),a=getFileSizeAndLength().sizeMB+.1,o=function(t){ehDownloadFS.errorHandler(t),ehDownloadFS.needFileSystem=!1,alert("An error occured when requesting FileSystem.\nError Name: "+(e.name||"Unknown Error")+"\nError Message: "+e.message+"\n\nRoll back and use Blob to handle file.")};if(setting["store-in-fs"]||!(300<=a)||confirm('This archive is too large (original size), please consider downloading this archive in a different way.\n\nMaximum allowed file size: Chrome / Opera 15+ 500MB | IE 10+ 600 MB | Firefox 20+ 800 MB\n(From FileSaver.js introduction)\n\nPlease also consider your operating system\'s free memory (RAM), it may take about DOUBLE the size of archive file size when generating ZIP file.\n\n* If you continue, you would probably get an error like "Failed - No File" or "Out Of Memory" if you don\'t have enough RAM and can\'t save the file successfully.\n\n* If you are using Chrome, you can try enabling "Request File System to handle large Zip file" on the settings page.\n\n* You can set Pages Range to download this archive in parts. If you have already enabled it, please ignore this message.\n\nAre you sure to continue downloading?')){setting["store-in-fs"]&&requestFileSystem&&a>=(void 0!==setting["fs-size"]?setting["fs-size"]:200)&&(ehDownloadFS.needFileSystem=!0,console.log("[EHD] Required File System Space >",r),navigator.webkitTemporaryStorage?navigator.webkitTemporaryStorage.queryUsageAndQuota(function(e,t){console.log("[EHD] Free TEMPORARY File System Space >",t-e),t-e<r?(console.log("[EHD] Free TEMPORARY File System Space is not enough."),navigator.webkitPersistentStorage.queryUsageAndQuota(function(e,t){console.log("[EHD] Free PERSISTENT File System Space >",t-e),t-e<r?(ehDownloadFS.needFileSystem=!1,alert("You don't have enough free space on the drive where Chrome stores user data (Default is system drive, normally it's C: ), please delete some files.\n\nNeeds more than "+(r-(t-e))+" Bytes.\n\nRoll back and use Blob to handle file.")):(pushDialog("\n<strong>Please allow storing large content if the browser asked for it.</strong>\n"),requestFileSystem(window.PERSISTENT,r,ehDownloadFS.initHandler,o))},o)):requestFileSystem(window.TEMPORARY,r,ehDownloadFS.initHandler,o)},o):requestFileSystem(window.TEMPORARY,r,ehDownloadFS.initHandler,o));var s=setting["save-info-list"].toString();0<=s.indexOf("title")&&(infoStr+=document.getElementById("gn").textContent.replaceHTMLEntites()+"\n"+document.getElementById("gj").textContent.replaceHTMLEntites()+"\n"+window.location.href.replaceHTMLEntites()+"\n\n"),0<=s.indexOf("metas")&&(infoStr+="Category: "+((document.querySelector(".ic").getAttribute("src").match(ehDownloadRegex.categoryTag)||[])[1]||document.querySelector(".ic").getAttribute("alt")).toUpperCase()+"\nUploader: "+document.querySelector("#gdn a").textContent.replaceHTMLEntites()+"\n");var l=document.querySelectorAll("#gdd tr");for(t=0;t<l.length;t++){var d=l[t].getElementsByClassName("gdt1")[0].textContent.replaceHTMLEntites(),u=l[t].getElementsByClassName("gdt2")[0].textContent.replaceHTMLEntites();0<=s.indexOf("metas")&&(infoStr+=d+" "+u+"\n")}if(0<=s.indexOf("metas")&&(infoStr+="Rating: "+unsafeWindow.average_rating+"\n\n"),0<=s.indexOf("tags")){infoStr+="Tags:\n";var c=document.querySelectorAll("#taglist tr");Array.prototype.forEach.call(c,function(e){var t=e.getElementsByTagName("td");infoStr+="> "+t[0].textContent+" ";var n=t[1].querySelectorAll("a");infoStr+=Array.prototype.map.call(n,function(e){return e.textContent}).join(", ")+"\n"}),infoStr+="\n"}if(0<=s.indexOf("uploader-comment")&&document.getElementById("comment_0")&&(infoStr+="Uploader Comment:\n"+document.getElementById("comment_0").innerHTML.replace(/<br>|<br \/>/gi,"\n")+"\n\n"),isDownloading=!0,pushDialog(infoStr),pushDialog("Start downloading at "+new Date+"\n"),ehDownloadDialog.appendChild(ehDownloadStatus),getAllPagesURL(),setting["play-silent-music"]){var h,f;(emptyAudio=new Audio(emptyAudioFile)).loop=!0,void 0!==document.hidden?(h="hidden",f="visibilitychange"):void 0!==document.mozHidden?(h="mozHidden",f="mozvisibilitychange"):void 0!==document.webkitHidden&&(h="webkitHidden",f="webkitvisibilitychange");var p=function(e){"boolean"!=typeof e&&(e=document[h]),e&&(isDownloading&&!isPausing||isSaving)?emptyAudio.play():emptyAudio.pause()};f?window.addEventListener(f,p):(window.addEventListener("focus",function(){p(!1)}),window.addEventListener("blur",function(){p(!0)})),p()}}}function initProgressTable(){(progressTable=document.createElement("table")).className="ehD-pt",ehDownloadDialog.style.display="block",ehDownloadDialog.appendChild(progressTable),ehDownloadDialog.appendChild(forceDownloadTips),ehDownloadDialog.appendChild(ehDownloadPauseBtn),ehDownloadDialog.scrollTop=ehDownloadDialog.scrollHeight}function requestDownload(e){if(!isPausing){if(setting["delay-request"]){var t=Date.now();delayTime<t&&(delayTime=t)}for(var n=0,i=fetchCount;i<(void 0!==setting["thread-count"]?setting["thread-count"]:5);i++)for(;n<totalCount;n++)if(null==imageData[n]&&(e||(retryCount[n]||0)<=(void 0!==setting["retry-count"]?setting["retry-count"]:3))){imageData[n]="Fetching",imageList[n]&&setting["never-new-url"]?fetchOriginalImage(n):setting["delay-request"]?(setTimeout(function(e){isPausing||fetchCount>=(void 0!==setting["thread-count"]?setting["thread-count"]:5)?imageData[e]=null:(getPageData(e),fetchCount++)},delayTime-t+1e3*setting["delay-request"],n),delayTime+=1e3*setting["delay-request"]):(getPageData(n),fetchCount++);break}}}function getPageData(a){if(!isPausing){if(pagesRange.length)var o=pagesRange[a];else o=a+1;var e=ehDownloadDialog.clientHeight+ehDownloadDialog.scrollTop>=ehDownloadDialog.scrollHeight,t=progressTable.querySelector('tr[data-index="'+a+'"]');t||((t=document.createElement("tr")).className="ehD-pt-item",t.setAttribute("data-index",a),t.innerHTML='\t\t\t<td class="ehD-pt-name">#'+o+'</td>\t\t\t<td class="ehD-pt-progress-outer">\t\t\t\t<progress class="ehD-pt-progress"></progress>\t\t\t\t<span class="ehD-pt-progress-text"></span>\t\t\t</td>\t\t\t<td class="ehD-pt-status">\t\t\t\t<span class="ehD-pt-status-text">Pending...</span>\t\t\t\t<span class="ehD-pt-abort">Force Abort</span>\t\t\t</td>',progressTable.appendChild(t)),e&&(ehDownloadDialog.scrollTop=ehDownloadDialog.scrollHeight);var s={current:t,fileName:t.getElementsByTagName("td")[0],status:t.getElementsByTagName("td")[2],statusText:t.getElementsByClassName("ehD-pt-status-text")[0],progress:t.getElementsByTagName("progress")[0],progressText:t.getElementsByTagName("span")[0],abort:t.getElementsByClassName("ehD-pt-abort")[0]};retryCount[a]=0;var l=imageList[a]?(imageList[a].pageURL+(!setting["never-send-nl"]&&imageList[a].nextNL?(0<=imageList[a].pageURL.indexOf("?")?"&":"?")+"nl="+imageList[a].nextNL:"")).replaceHTMLEntites():pageURLsList[o-1],d=fetchThread[a]=new XMLHttpRequest;d.onload=function(){if(200===d.status&&d.responseText){try{var e=-1!==unsafeWindow.apiuid&&0<=d.responseText.indexOf("fullimg.php")&&!setting["force-resized"]?d.responseText.match(ehDownloadRegex.imageURL[0])[1].replaceHTMLEntites():-1<d.responseText.indexOf('id="img"')?d.responseText.match(ehDownloadRegex.imageURL[1])[1].replaceHTMLEntites():d.responseText.match(ehDownloadRegex.imageURL[2])[1].replaceHTMLEntites(),t=d.responseText.match(ehDownloadRegex.fileName)[1].replaceHTMLEntites(),n=ehDownloadRegex.nl.test(d.responseText)?d.responseText.match(ehDownloadRegex.nl)[1]:null}catch(e){return console.error("[EHD] Response content is not correct!",e),void(retryCount[a]<(void 0!==setting["retry-count"]?setting["retry-count"]:3)?(retryCount[a]++,updateProgress(s,{status:"Retrying ("+retryCount[a]+"/"+(void 0!==setting["retry-count"]?setting["retry-count"]:3)+")...",progress:"",progressText:"",class:"ehD-pt-warning"}),d.open("GET",l),d.timeout=3e4,d.send()):(failedCount++,fetchCount--,console.error("[EHD] #"+o+": Can't get request content from response content"),updateProgress(s,{status:"Response Error",progress:"0",progressText:"",class:"ehD-pt-failed"}),updateTotalStatus(),checkFailed()))}var i="";if(needNumberImages)if(!setting["number-real-index"]&&pagesRange.length){var r=pagesRange.length.toString().length;i=(new Array(r<3?r+1:r).join("0")+(a+1)).slice(0-r)}else{r=pageURLsList.length.toString().length;i=(new Array(r<3?r+1:r).join("0")+o).slice(0-r)}imageList[a]=new PageData(l,e,t,n,o,i),isPausing?(updateProgress(s,{name:"#"+o+": "+t,status:"Force Paused",progress:"",progressText:"",class:""}),fetchCount--,imageData[a]=null,updateTotalStatus()):fetchOriginalImage(a,s)}else retryCount[a]<(void 0!==setting["retry-count"]?setting["retry-count"]:3)?(retryCount[a]++,updateProgress(s,{status:"Retrying ("+retryCount[a]+"/"+(void 0!==setting["retry-count"]?setting["retry-count"]:3)+")...",progress:"",progressText:"",class:"ehD-pt-warning"}),d.open("GET",l),d.timeout=3e4,d.send()):(failedCount++,fetchCount--,console.error("[EHD] #"+o+": Failed getting image URL"),updateProgress(s,{status:"Failed getting URL",progress:"0",progressText:"",class:"ehD-pt-failed"}),updateTotalStatus(),checkFailed())},d.onerror=d.ontimeout=function(){retryCount[a]<(void 0!==setting["retry-count"]?setting["retry-count"]:3)?(retryCount[a]++,updateProgress(s,{status:"Retrying ("+retryCount[a]+"/"+(void 0!==setting["retry-count"]?setting["retry-count"]:3)+")...",progress:"",progressText:"",class:"ehD-pt-warning"}),d.open("GET",l),d.timeout=3e4,d.send()):(failedCount++,fetchCount--,console.error("[EHD] #"+o+": Failed getting image URL"),updateProgress(s,{status:"Failed getting URL",progress:"0",progressText:"",class:"ehD-pt-failed"}),updateTotalStatus(),checkFailed())},d.open("GET",l),d.timeout=3e4,d.send(),s.abort.addEventListener("click",function(){!isDownloading||imageData[a]instanceof ArrayBuffer||(void 0!==fetchThread[a]&&"abort"in fetchThread[a]&&fetchThread[a].abort(),console.log("[EHD] #"+(a+1)+": Force Aborted By User"),updateProgress(s,{status:"Failed! (User Aborted)",progress:"0",progressText:"",class:"ehD-pt-warning"}),failedFetching(a,s))}),s.status.setAttribute("data-inited-abort","1")}}function showSettings(){var a=document.createElement("div");for(var n in a.className="ehD-setting",a.setAttribute("data-active-setting","basic"),a.innerHTML='\t\t<ul class="ehD-setting-tab">\t\t\t<li data-target-setting="basic">Basic</li>\t\t\t<li data-target-setting="advanced">Advanced</li>\t\t</ul>\t\t<div class="ehD-feedback">\t\t\t'+ehDownloadArrow+' <strong>Feedback</strong>\t\t\t<a href="https://github.com/ccloli/E-Hentai-Downloader/issues" target="_blank">GitHub</a>\t\t\t<a href="https://sleazyfork.org/scripts/10379-e-hentai-downloader/feedback" target="_blank">GreasyFork</a>\t\t</div>\t\t<div class="ehD-setting-main">\t\t\t<div class="ehD-setting-wrapper">\t\t\t\t<div data-setting-page="basic" class="ehD-setting-content">\t\t\t\t\t<div class="g2"><label>Download <input type="number" data-ehd-setting="thread-count" min="1" placeholder="5" style="width: 46px;"> images at the same time ( 5 is recommended)</label></div>\t\t\t\t\t<div class="g2"'+(GM_info.scriptHandler&&"Violentmonkey"===GM_info.scriptHandler?' style="opacity: 0.5;" title="Violentmonkey may not support this feature"':"")+'><label>Abort downloading current image after <input type="number" data-ehd-setting="timeout" min="0" placeholder="300" style="width: 46px;"> second(s) (0 is never abort)</label></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="speed-detect"> Abort downloading current image if speed is less than <input type="number" data-ehd-setting="speed-min" min="0" placeholder="5" style="width: 46px;"> KB/s in <input type="number" data-ehd-setting="speed-expired" min="1" placeholder="30" style="width: 46px;"> second(s)</label></div>\t\t\t\t\t<div class="g2"><label>Skip current image after retried <input type="number" data-ehd-setting="retry-count" min="1" placeholder="3" style="width: 46px;"> time(s)</label></div>\t\t\t\t\t<div class="g2"><label>Delay <input type="number" data-ehd-setting="delay-request" min="0" placeholder="0" step="0.1" style="width: 46px;"> second(s) before requesting next image</label></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="number-images"> Number images (00101.jpg, 00201_theme.jpg, 00302.jpg...) (Separator <input type="text" data-ehd-setting="number-separator" style="width: 46px;" placeholder="">)</label></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="number-real-index"> Number images with original page number if pages range is set</label></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="number-auto-retry"> Retry automatically when images download failed</label></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="auto-download-cancel"> Get downloaded images automatically when canceled downloading</label></div>\t\t\t\t\t<div class="g2"><label>Set folder name as <input type="text" data-ehd-setting="dir-name" placeholder="{gid}_{token}" style="width: 110px;"> (if you don\'t want to create folder, use "<code>/</code>") *</label></div>\t\t\t\t\t<div class="g2"><label>Set Zip file name as <input type="text" data-ehd-setting="file-name" placeholder="{title}" style="width: 110px;"> *</label></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="recheck-file-name"> Show inputs to recheck file name and folder name before downloading</label></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="ignore-torrent"> Never show notification if torrents are available</label></div>\t\t\t\t\t<div class="g2"><label><select data-ehd-setting="status-in-title"><option value="never">Never</option><option value="blur">When current tab is not focused</option><option value="always">Always</option></select> show download progress in title</label></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="hide-image-limits"> Disable requesting and showing image limits</label></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="hide-estimated-cost"> Disable pre-calculating image limits cost</label></div>\t\t\t\t\t<div class="ehD-setting-note">\t\t\t\t\t\t<div class="g2">\t\t\t\t\t\t\t* Available templates: \t\t\t\t\t\t\t<span title="You can find GID and token at the address bar like this: exhentai.org/g/[GID]/[Token]/">{gid} Gallery GID</sapn> | \t\t\t\t\t\t\t<span title="You can find GID and token at the address bar like this: exhentai.org/g/[GID]/[Token]/">{token} Gallery token</sapn> | \t\t\t\t\t\t\t<span title="This title is the English title or Latin transliteration, you can find it as the first line of the title.">{title} Gallery title</span> | \t\t\t\t\t\t\t<span title="This title is the original language title, you can find it as the second line of the title.">{subtitle} Gallery sub-title</span> | \t\t\t\t\t\t\t<span title="This tag means the sort name of the gallery, and its output string is upper.">{tag} Gallery tag</span> | \t\t\t\t\t\t\t<span title="You can find it at the left of the gallery page.">{uploader} Gallery uploader</span>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div data-setting-page="advanced" class="ehD-setting-content">\t\t\t\t\t<div class="g2"><label>Set compression level as <input type="number" data-ehd-setting="compression-level" min="0" max="9" placeholder="0" style="width: 46px;"> (0 ~ 9, 0 is only store, not recommended to enable)</label></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="file-descriptor"> Stream files and create Zip with file descriptors </label><sup>(1)</sup></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="force-resized"> Force download resized image (never download original image) </label><sup>(2)</sup></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="never-new-url"> Never get new image URL when failed to download image </label><sup>(2)</sup></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="never-send-nl"> Never send "nl" GET parameter when getting new image URL </label><sup>(2)</sup></div>\t\t\t\t\t<div class="g2"'+(requestFileSystem?"":' style="opacity: 0.5;" title="Only Chrome supports this feature"')+'><label><input type="checkbox" data-ehd-setting="store-in-fs"> Request File System to handle large Zip file </label><sup>(3)</sup></div>\t\t\t\t\t<div class="g2"'+(requestFileSystem?"":' style="opacity: 0.5;" title="Only Chrome supports this feature"')+'><label>Use File System if archive is larger than <input type="number" data-ehd-setting="fs-size" min="0" placeholder="200" style="width: 46px;"> MB (0 is always) </label><sup>(3)</sup></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="play-silent-music"> Play silent music during the process to avoid downloading freeze </label><sup>(4)</sup></div>\t\t\t\t\t<div class="g2"><label>Record and save gallery info as <select data-ehd-setting="save-info"><option value="file">File info.txt</option><option value="comment">Zip comment</option><option value="none">None</option></select></label></div>\t\t\t\t\t<div class="g2">...which includes <label><input type="checkbox" data-ehd-setting="save-info-list[]" value="title">Title & Gallery Link</label> <label><input type="checkbox" data-ehd-setting="save-info-list[]" value="metas">Metadatas</label> <label><input type="checkbox" data-ehd-setting="save-info-list[]" value="tags">Tags</label> <label><input type="checkbox" data-ehd-setting="save-info-list[]" value="uploader-comment">Uploader Comment</label> <label><input type="checkbox" data-ehd-setting="save-info-list[]" value="page-links">Page Links</label></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="replace-with-full-width"> Replace forbidden characters with full-width characters instead of dash (-)</label></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="force-pause"> Force drop downloaded images data when pausing download</label></div>\t\t\t\t\t<div class="g2"><label><input type="checkbox" data-ehd-setting="save-as-cbz"> Save as CBZ (Comic book archive) file<sup>(5)</sup></label></div>\t\t\t\t\t<div class="ehD-setting-note">\t\t\t\t\t\t<div class="g2">\t\t\t\t\t\t\t(1) This may reduce memory usage but some decompress softwares may not support the Zip file. See <a href="https://stuk.github.io/jszip/documentation/api_jszip/generate_async.html" target="_blank" style="color: #ffffff;">JSZip Docs</a> for more info.\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="g2">\t\t\t\t\t\t\t(2) Enable these options may save your image viewing limits <a href="https://github.com/ccloli/E-Hentai-Downloader/wiki/E%E2%88%92Hentai-Image-Viewing-Limits" target="_blank" style="color: #ffffff;">(See wiki)</a>, but may also cause some download problems.\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="g2">\t\t\t\t\t\t\t(3) If enabled you can save larger Zip files (probably ~1GB).\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="g2">\t\t\t\t\t\t\t(4) If enabled will play slient music to avoid downloading freeze when page is in background <a href="https://github.com/ccloli/E-Hentai-Downloader/issues/65" target="_blank">(See issue)</a>. Only needed if you have the problem, because the audio-playing icon maybe annoying.\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="g2">\t\t\t\t\t\t\t(5) <a href="https://en.wikipedia.org/wiki/Comic_book_archive">Comic book archive</a> is a file type to archive comic images, you can open it with some comic viewer like CDisplay/CDisplayEX, or just extract it as a Zip file. To keep the order of images, you can also enable numbering images.\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t</div>\t\t</div>\t\t<div class="ehD-setting-footer" style="text-align: center">\t\t\t<button data-action="save">Save</button> <button data-action="cancel">Cancel</button>\t\t</div>',document.body.appendChild(a),setting)if(setting[n]instanceof Array)setting[n].forEach(function(e){var t=a.querySelector('input[data-ehd-setting="'+n+'[]"][value="'+e+'"], select[data-ehd-setting="'+n+'[]"] option[value="'+e+'"]');t&&("checkbox"===t.getAttribute("type")?t.setAttribute("checked","checked"):"option"===t.tagName.toLowerCase()?t.setAttribute("selected","selected"):t.value=e)});else{var e=a.querySelector('input[data-ehd-setting="'+n+'"], select[data-ehd-setting="'+n+'"]');if(!e)continue;if("checkbox"===e.getAttribute("type"))setting[n]&&e.setAttribute("checked","checked");else if("select"===e.tagName.toLowerCase()){if(!(e=e.querySelector('option[value="'+setting[n]+'"]')))continue;e.setAttribute("selected","selected")}else e.setAttribute("value",setting[n])}a.getElementsByClassName("ehD-setting-tab")[0].addEventListener("click",function(e){var t=e.target;"li"===t.tagName.toLowerCase()&&a.setAttribute("data-active-setting",t.dataset.targetSetting)}),a.getElementsByClassName("ehD-setting-footer")[0].addEventListener("click",function(e){var t=e.target;if("button"===t.tagName.toLowerCase()){if("save"===t.dataset.action){var n=a.querySelectorAll("input[data-ehd-setting], select[data-ehd-setting]");setting={};for(var i=0;i<n.length;i++)if("checkbox"===n[i].getAttribute("type")||""!==n[i].value){var r=n[i].dataset.ehdSetting;"checkbox"===n[i].getAttribute("type")?n[i].checked&&(n[i].hasAttribute("value")?0<=r.indexOf("[]")?(r=r.split("[]")[0],setting[r]||(setting[r]=[]),setting[r].push(n[i].getAttribute("value"))):setting[r]=n[i].getAttribute("value"):setting[r]=n[i].checked):"number"===n[i].getAttribute("type")?(setting[r]=Number(n[i].value),isNaN(setting[r])&&(setting[r]=Number(n[i].getAttribute("placeholder")))):setting[r]=n[i].value}GM_setValue("ehD-setting",JSON.stringify(setting))}document.body.removeChild(a),document.querySelector(".ehD-box-extend")?toggleFilenameConfirmInput("reset"):toggleFilenameConfirmInput(!setting["recheck-file-name"]),showPreCalcCost()}}),Array.prototype.forEach.call(a.getElementsByClassName("ehD-setting-content"),function(e){e.addEventListener("focusin",function(e){a.setAttribute("data-active-setting",this.dataset.settingPage),a.scrollLeft=0},!0)})}function getImageLimits(e,n){"exhentai.org"===(n=n||location.hostname)&&(n="e-hentai.org");var t="https://"+n+"/home.php",i=JSON.parse(localStorage.getItem("ehd-image-limits-"+n)||'{"timestamp":0}');if(!e&&new Date-i.timestamp<3e4)return showImageLimits();console.log("[EHD] Request Image Limits From "+n),GM_xmlhttpRequest({method:"GET",url:t,timeout:3e5,onload:function(e){if(e.responseText){var t=e.responseText.match(ehDownloadRegex.imageLimits);t&&3===t.length&&(i.cur=t[1],i.total=t[2],i.timestamp=(new Date).getTime(),localStorage.setItem("ehd-image-limits-"+n,JSON.stringify(i)),showImageLimits())}}})}function showImageLimits(){var e=Object.keys(localStorage).filter(function(e){return 0===e.indexOf("ehd-image-limits-")}).sort().map(function(e){var t=JSON.parse(localStorage.getItem(e));return t.cur+"/"+t.total});ehDownloadBox.getElementsByClassName("ehD-box-limit")[0].innerHTML=' | <a href="https://e-hentai.org/home.php">Image Limits: '+e.join("; ")+"</a>"}console.log("[EHD] UserAgent >",navigator.userAgent),console.log("[EHD] Script Handler >",GM_info.scriptHandler||(0<=navigator.userAgent.indexOf("Firefox")?"GreaseMonkey":0<=navigator.userAgent.indexOf("Opera")||0<=navigator.userAgent.indexOf("Maxthon")?"Violentmonkey":void 0)),console.log("[EHD] Script Handler Version >",GM_info.version),console.log("[EHD] E-Hentai Downloader Version >",GM_info.script.version),console.log("[EHD] Current URL >",window.location.href),console.log("[EHD] Is Logged In >",-1!==unsafeWindow.apiuid),String.prototype.replaceHTMLEntites=function(){return this.replace(/&(#[xX]?\d+|[a-zA-Z]+);/g,function(e,t){return function(e){var t={euro:"",nbsp:" ",quot:'"',amp:"&",lt:"<",gt:">",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",times:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",szlig:"",divide:""};if(t[e])return t[e];if(/#\d+/.test(e)){var n=e.match(/#(\d+)/)[1]-0;return String.fromCharCode(n)}if(/#[xX][0-9a-f]+/.test(e))return n=parseInt(e.match(/#[xX]([0-9a-f]+)/)[1]-0,16),String.fromCharCode(n);return"&"+e+";"}(t.toLowerCase())})};var getFileSizeAndLength=function(){var e,t,n=document.getElementById("gdd").textContent,i=n.split("File Size:")[1].split("Length:")[0].trim(),r=n.split("Length:")[1].split("page")[0].trim()-0;t=0<=i.indexOf("MB")?1024*(e=parseFloat(i)+.01):0<=i.indexOf("GB")?1024*(e=1024*(parseFloat(i)+.01)):(e=1,parseFloat(i));var a={sizeMB:e,sizeKB:t,size:1024*t,page:r};return getFileSizeAndLength=function(){return a},a};function toggleFilenameConfirmInput(e){var t=document.querySelector(".ehD-box-extend");t?"reset"===e?(ehDownloadBox.removeChild(t),setting["recheck-file-name"]&&toggleFilenameConfirmInput()):t.style.display=e?"none":"block":e||((t=document.createElement("div")).className="ehD-box-extend",t.innerHTML='<div class="g2">'+ehDownloadArrow+' <a>File Name <input type="text" class="ehD-box-extend-filename"></a></div><div class="g2">'+ehDownloadArrow+' <a>Path Name <input type="text" class="ehD-box-extend-dirname"></a></div>',ehDownloadBox.appendChild(t),dirName=getReplacedName(setting["dir-name"]?setting["dir-name"]:"{gid}_{token}"),fileName=getReplacedName(setting["file-name"]?setting["file-name"]:"{title}"),t.getElementsByClassName("ehD-box-extend-filename")[0].value=fileName,t.getElementsByClassName("ehD-box-extend-dirname")[0].value=dirName)}function showPreCalcCost(){var e=0,t=getFileSizeAndLength().page;setting["force-resized"]||(e=getFileSizeAndLength().sizeMB),ehDownloadBox.getElementsByClassName("ehD-box-cost")[0].innerHTML=' | <a href="https://github.com/ccloli/E-Hentai-Downloader/wiki/E%E2%88%92Hentai-Image-Viewing-Limits" target="_blank">Estimated Limits Cost: '+(parseInt(5*e)+t)+"</a>"}var ehDownloadBox=document.createElement("fieldset");ehDownloadBox.className="ehD-box";var ehDownloadBoxTitle=document.createElement("legend");ehDownloadBoxTitle.innerHTML='E-Hentai Downloader <span class="ehD-box-limit"></span> <span class="ehD-box-cost"></span>',0<=origin.indexOf("exhentai.org")&&(ehDownloadBoxTitle.style.color="#ffff66"),ehDownloadBox.appendChild(ehDownloadBoxTitle);var ehDownloadStylesheet=document.createElement("style");ehDownloadStylesheet.textContent=ehDownloadStyle,ehDownloadBox.appendChild(ehDownloadStylesheet);var ehDownloadArrow='<img src="data:image/gif;base64,R0lGODlhBQAHALMAAK6vr7OztK+urra2tkJCQsDAwEZGRrKyskdHR0FBQUhISP///wAAAAAAAAAAAAAAACH5BAEAAAsALAAAAAAFAAcAAAQUUI1FlREVpbOUSkTgbZ0CUEhBLREAOw==">',ehDownloadAction=document.createElement("div");ehDownloadAction.className="g2",ehDownloadAction.innerHTML=ehDownloadArrow+" <a>Download Archive</a>",ehDownloadAction.addEventListener("click",function(e){e.preventDefault();var t=document.querySelector('#gd5 a[onclick*="gallerytorrents.php"]'),n=t?t.textContent.match(/\d+/)[0]-0:0;if(!isDownloading||confirm("E-Hentai Downloader is working now, are you sure to stop downloading and start a new download?"))return!setting["ignore-torrent"]&&0<n&&!confirm("There are "+n+" torrent(s) available for this gallery. You can download the torrent(s) to get a stable and controllable download experience without spending your image limits, or even get bonus content.\n\nContinue downloading with E-Hentai Downloader (Yes) or use torrent(s) directly (No)?\n(You can disable this notification in the Settings)")?t.dispatchEvent(new MouseEvent("click")):void((-1!==unsafeWindow.apiuid||confirm("You are not logged in to E-Hentai Forums, so you can't download original image. Continue?"))&&(ehDownloadDialog.innerHTML="",initEHDownload()))}),ehDownloadBox.appendChild(ehDownloadAction);var ehDownloadNumberInput=document.createElement("div");ehDownloadNumberInput.className="g2",ehDownloadNumberInput.innerHTML=ehDownloadArrow+' <a><label><input type="checkbox" style="vertical-align: middle; margin: 0;"> Number Images<label></a>',ehDownloadBox.appendChild(ehDownloadNumberInput);var ehDownloadRange=document.createElement("div");ehDownloadRange.className="g2",ehDownloadRange.innerHTML=ehDownloadArrow+' <a><label>Pages Range <input type="text" placeholder="eg. -10,12,14-20,27,30-40/2,50-60/3,70-"></label></a>',ehDownloadBox.appendChild(ehDownloadRange);var ehDownloadSetting=document.createElement("div");ehDownloadSetting.className="g2",ehDownloadSetting.innerHTML=ehDownloadArrow+" <a>Settings</a>",ehDownloadSetting.addEventListener("click",function(e){e.preventDefault(),showSettings()}),ehDownloadBox.appendChild(ehDownloadSetting),document.body.insertBefore(ehDownloadBox,document.getElementById("asm")||document.querySelector(".gm").nextElementSibling);var ehDownloadDialog=document.createElement("div");ehDownloadDialog.className="ehD-dialog",document.body.appendChild(ehDownloadDialog);var ehDownloadStatus=document.createElement("div");ehDownloadStatus.className="ehD-status",ehDownloadStatus.addEventListener("click",function(e){e.preventDefault(),ehDownloadDialog.classList.toggle("hidden")});var ehDownloadPauseBtn=document.createElement("button");ehDownloadPauseBtn.className="ehD-pause",ehDownloadPauseBtn.textContent="Pause",ehDownloadPauseBtn.addEventListener("click",function(e){isPausing?(isPausing=!1,ehDownloadPauseBtn.textContent=setting["force-pause"]?"Pause (Downloading images will be aborted)":"Pause (Downloading images will keep downloading)",requestDownload()):(isPausing=!0,ehDownloadPauseBtn.textContent="Resume",setting["force-pause"]&&setTimeout(function(){for(var e=0;e<fetchThread.length;e++)if(void 0!==fetchThread[e]&&"abort"in fetchThread[e]&&fetchThread[e].abort(),"Fetching"===imageData[e]&&retryCount[e]<(void 0!==setting["retry-count"]?setting["retry-count"]:3)){var t=progressTable.querySelector('tr[data-index="'+e+'"] .ehD-pt-status-text');t&&(t.textContent="Force Paused"),(t=progressTable.querySelector('tr[data-index="'+e+'"] .ehD-pt-progress-text'))&&(t.textContent=""),imageData[e]=null,fetchCount--,updateTotalStatus()}},0),emptyAudio&&emptyAudio.pause())}),window.addEventListener("focus",function(){if("blur"===setting["status-in-title"]){if(!needTitleStatus)return;document.title=pretitle,needTitleStatus=!1}}),window.addEventListener("blur",function(){isDownloading&&"blur"===setting["status-in-title"]&&(needTitleStatus=!0,document.title="["+(isPausing?"":downloadedCount<totalCount?" "+downloadedCount+"/"+totalCount:0===totalCount?"":"")+"] "+pretitle)});var forceDownloadTips=document.createElement("div");forceDownloadTips.className="ehD-force-download-tips",forceDownloadTips.innerHTML='If an error occured and script doesn\'t work, click <a href="javascript: getzip();" style="font-weight: bold; pointer-events: auto;" title="Force download won\'t stop current downloading task.">here</a> to force get your downloaded images.',forceDownloadTips.getElementsByTagName("a")[0].addEventListener("click",function(e){e.preventDefault(),saveDownloaded(!0)});var closeTips=document.createElement("div");closeTips.className="ehD-close-tips",closeTips.innerHTML="E-Hentai Downloader is still running, please don't close this tab until it finished downloading.<br><br>If any bug occured and the script doesn't work correctly, you can move your mouse pointer onto the progress box, and force to save downloaded images before you leave.",unsafeWindow.getzip=window.getzip=function(){saveDownloaded(!0)},initSetting(),window.addEventListener("storage",showImageLimits),window.onbeforeunload=unsafeWindow.onbeforeunload=function(){if(isDownloading||isPausing||isSaving)return document.body.appendChild(closeTips),setTimeout(function(){document.body.removeChild(closeTips)},100),"E-Hentai Downloader is still running, please don't close this tab until it finished downloading.";!function(){for(var e=0;e<fetchThread.length;e++)void 0!==fetchThread[e]&&"abort"in fetchThread[e]&&fetchThread[e].abort();ehDownloadFS.removeFile(unsafeWindow.gid+".zip")}()};